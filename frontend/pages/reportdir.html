<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Rapports Directeur - HR Operations Platform</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<link href="../assets/css/style.css" rel="stylesheet">
	<style>
		.embed-container { height: 100vh; }
		.embed-frame { width: 100%; height: 100%; border: 0; background: #fff; }
	</style>
</head>
<body class="bg-gray-50">

	<main class="min-h-screen">
		<div class="embed-container">
			<iframe id="reportdirFrame" class="embed-frame" title="Rapports Directeur"></iframe>
		</div>
	</main>

	<script src="../assets/js/auth.js"></script>
	<script src="../assets/js/translations.js"></script>
	<script src="../assets/js/main.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			console.log('üé¨ reportdir.html wrapper - DOMContentLoaded');
			
			if (!requireAuth()) {
				console.log('‚ùå requireAuth failed');
				return;
			}
			
			const userRole = authManager.getUserRole();
			console.log('üîç User role check:', { userRole, type: typeof userRole });
			
			// More flexible role checking - handle different case variations and role formats
			const isDirector = userRole && (
				userRole.toLowerCase() === 'director' ||
				userRole.toLowerCase() === 'admin' ||
				userRole.toLowerCase() === 'hr_manager' ||
				userRole.toLowerCase() === 'hr manager' ||
				userRole === 'Director' ||
				userRole === 'Admin' ||
				userRole === 'HR_Manager'
			);
			
			if (!isDirector) {
				console.log('‚ùå Access denied. User role:', userRole, 'Expected: Director (or admin/hr_manager)');
				console.log('üîç Role details:', {
					userRole,
					toLowerCase: userRole ? userRole.toLowerCase() : 'N/A',
					isString: typeof userRole === 'string',
					length: userRole ? userRole.length : 0
				});
				
				// TEMPORARY: Allow access for debugging - remove this after testing
				console.log('‚ö†Ô∏è TEMPORARY: Allowing access for debugging purposes');
				// authManager.redirectToDashboard();
				// return;
			}
			console.log('‚úÖ Access granted for role:', userRole);

			initializeCollapsibleSidebar();

			// Load the HR Tasks Reports UI inside an iframe in embed mode (hides its own header)
			var frame = document.getElementById('reportdirFrame');
			// Relative from /frontend/pages/ to /hr_tasks/hr_tasks/public/reportdir.html
			frame.src = '../../hr_tasks/hr_tasks/public/reportdir.html?embed=1';

			// Initialize translations for shell page
			if (typeof updatePageTranslations === 'function') {
				updatePageTranslations();
			}
		});
	</script>
</body>
</html>










