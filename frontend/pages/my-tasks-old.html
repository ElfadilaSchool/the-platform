<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">  
        <title data-translate="tasks.my_tasks">My Tasks - HR Operations Platform</title>                                                                              
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">                                                
        <link href="../assets/css/style.css" rel="stylesheet">
        <style>
                /* The old sidebar and header will be removed by JavaScript */
                
                .embed-container { 
                        height: calc(100vh - 200px); 
                        margin-top: 1rem;
                }
                .embed-frame { 
                        width: 100%; 
                        height: 100%; 
                        border: 0; 
                        background: #fff;
                        border-radius: 0.5rem;
                        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
                }
                .page-header {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 2rem;
                        border-radius: 0.5rem;
                        margin-bottom: 1rem;
                        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                }
        </style>
</head>
<body class="bg-gray-50">
        <div class="min-h-screen p-6" style="margin-left: 4rem;">
                <!-- Page Header -->
              

                <!-- Tasks Content -->
                <main class="max-w-7xl mx-auto">
                        <div class="embed-container">
                                <iframe id="myTasksFrame" class="embed-frame" title="My Tasks"></iframe>                                                                     
                        </div>
                </main>
        </div>

        <script src="../assets/js/auth.js"></script>
        <script src="../assets/js/translations.js"></script>
        <script src="../assets/js/main.js"></script>
        <script>
                // Function to remove only the old sidebar and header (not the collapsible sidebar)
                function removeOldSidebarAndHeader() {
                        // Find old sidebar by looking for sidebarNav ID
                        const sidebarNav = document.getElementById('sidebarNav');
                        if (sidebarNav) {
                                const parentSidebar = sidebarNav.closest('.bg-white.w-64.shadow-lg, #localSidebar');
                                if (parentSidebar && !parentSidebar.id.includes('collapsible')) {
                                        parentSidebar.remove();
                                }
                        }
                        
                        // Find old header by looking for empNotifBell ID
                        const notifBell = document.getElementById('empNotifBell');
                        if (notifBell) {
                                const parentHeader = notifBell.closest('.flex.items-center.justify-between.px-6.py-4');
                                if (parentHeader) {
                                        parentHeader.remove();
                                }
                        }
                        
                        // Also look for userRoleDisplay which is in the old sidebar
                        const userRoleDisplay = document.getElementById('userRoleDisplay');
                        if (userRoleDisplay) {
                                const parentSidebar = userRoleDisplay.closest('.bg-white.w-64.shadow-lg, #localSidebar');
                                if (parentSidebar && !parentSidebar.id.includes('collapsible')) {
                                        parentSidebar.remove();
                                }
                        }
                        
                        // Remove flex containers that wrap the old sidebar (but keep collapsible sidebar)
                        const flexContainers = document.querySelectorAll('.flex.h-screen');
                        flexContainers.forEach(container => {
                                // Only remove if it contains the old sidebar elements, not the collapsible sidebar
                                const hasOldSidebar = container.querySelector('#sidebarNav, #userRoleDisplay');
                                const hasCollapsibleSidebar = container.querySelector('#collapsibleSidebar');
                                if (hasOldSidebar && !hasCollapsibleSidebar) {
                                        const mainContent = container.querySelector('main, .main-content');
                                        if (mainContent && container.parentNode === document.body) {
                                                document.body.appendChild(mainContent);
                                        }
                                        container.remove();
                                }
                        });
                }
                
                document.addEventListener('DOMContentLoaded', function() {      
                        if (!requireAuth()) return;
                        
                        // Remove old sidebar/header after main.js runs (main.js will initialize collapsible sidebar)
                        setTimeout(removeOldSidebarAndHeader, 100);
                        setTimeout(removeOldSidebarAndHeader, 500);
                        
                        // Load the HR Tasks UI inside an iframe in embed mode (hides its own sidebar)                                                          
                        var frame = document.getElementById('myTasksFrame');      
                        // Relative from /frontend/pages/ to /hr_tasks/hr_tasks/public/my-tasks.html                                                               
                        frame.src = '../../hr_tasks/hr_tasks/public/my-tasks.html?embed=1';                                                                        

                        // Initialize translations
                        if (typeof updatePageTranslations === 'function') {     
                                updatePageTranslations();
                        }
                });
                
                // Watch for dynamically added old sidebars/headers
                const observer = new MutationObserver(function(mutations) {
                        removeOldSidebarAndHeader();
                });
                
                observer.observe(document.body, {
                        childList: true,
                        subtree: true
                });
        </script>
</body>
</html>

