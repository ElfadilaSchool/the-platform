<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<script type="text/javascript">
  // This is a CodeSandbox injection script that's used to
  // add navigation and inspector functionality to the preview
  (function () {
    // 1) Get the <script> tag that's currently running:
    var me = document.currentScript;

    // 2) Create the blocking‐style <script> to load:
    var script = document.createElement("script");
    script.src = "https://codesandbox.io/p/preview-protocol.js";

    // By default a dynamically‐inserted <script> is async=true.
    // Turn async off to make it behave like a normal blocking <script>:
    script.async = false;
    // (Do NOT set defer.)

    // 3) Insert it immediately after the current <script>:
    me.parentNode.insertBefore(script, me);
  })();

  const isIFramePreview = window.top !== window.self;

  // Only run this script in editor context
  if (isIFramePreview) {
    // This script is used to enable Chrome DevTools functionality
    (function () {
      var script = document.createElement("script");
      script.src =
        "https://codesandbox.io/p/chrome-devtool/protocol/index.js";

      script.onload = () => {
        const devtoolProtocol = window.chobitsu;
        if (devtoolProtocol) {
          window.addEventListener("message", (event) => {
            const { type, data } = event.data;

            if (type === "FROM_DEVTOOL") {
              devtoolProtocol.sendRawMessage(data);
            }
          });

          devtoolProtocol.setOnMessage((data) => {
            if (data.includes('"id":"tmp')) {
              return;
            }

            window.parent.postMessage({ type: "TO_DEVTOOL", data }, "*");
          });

          devtoolProtocol.sendRawMessage(
            `{"id":5,"method":"Runtime.enable","params":{}}`
          );
        }        
      }

      (document.head || document.documentElement).prepend(script);
    })();
  }

  if (typeof __REACT_DEVTOOLS_GLOBAL_HOOK__ === "undefined") {
    let nextID = 0;
    let hook = (__REACT_DEVTOOLS_GLOBAL_HOOK__ = {
      renderers: new Map(),
      supportsFiber: true,
      inject: (renderer) => {
        const id = nextID++;
        hook.renderers.set(id, renderer);
        return id;
      },
      onScheduleFiberRoot() {},
      onCommitFiberRoot() {},
      onCommitFiberUnmount() {},
    });
  }

  document.currentScript.remove();
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="salary.payslips">My Payslips - HR Operations Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../assets/css/style.css" rel="stylesheet">
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/main.js"></script>
    <style>
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            width: fit-content;
            min-width: auto;
        }
        .status-uploaded { background-color: #d1fae5; color: #065f46; }
        .status-not_uploaded { background-color: #fecaca; color: #991b1b; }
        .table-row:hover { background-color: #f9fafb; }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- The reusable navbar will be automatically inserted here -->
    
    <!-- Main Content -->
    <div class="main-content flex-1 overflow-y-auto">

            <!-- Content -->
            <main class="flex-1 overflow-y-auto p-6">
                <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm mb-6 p-6">
            <div class="flex justify-between items-start">
                <div class="flex-1">
                    <h1 class="text-2xl font-bold text-gray-900 mb-2" data-translate="salary.payslips">My Payslips</h1>
                    <p class="text-gray-600" data-translate="salary.view_details">View and download your monthly pay slips</p>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Language Selector -->
                    <select id="languageSelector" class="bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="en">English</option>
                        <option value="fr">Français</option>
                        <option value="ar">العربية</option>
                    </select>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="salary.month">Month</label>
                        <select id="filterMonth" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="" data-translate="common.filter">All</option>
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="salary.year">Year</label>
                        <select id="filterYear" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="" data-translate="common.filter">All</option>
                        </select>
                    </div>
                    <button id="refreshBtn" class="bg-gray-200 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm" data-translate-title="common.search" title="Refresh">
                        <i class="fas fa-rotate"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Summary Card -->
        <div class="bg-white rounded-lg shadow-sm mb-6 p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="text-2xl font-semibold text-blue-600" id="totalPayslips">-</div>
                    <div class="text-sm text-gray-500" data-translate="salary.payslips">Total Payslips</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-semibold text-green-600" id="availablePayslips">-</div>
                    <div class="text-sm text-gray-500" data-translate="common.view">Available</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-semibold text-red-600" id="missingPayslips">-</div>
                    <div class="text-sm text-gray-500" data-translate="message.error">Missing</div>
                </div>
            </div>
        </div>

        <!-- Main Table -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-translate="salary.month">Month</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-translate="salary.year">Year</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-translate="common.status">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-translate="common.download">File</th>
                        </tr>
                    </thead>
                    <tbody id="myPayslipsBody" class="bg-white divide-y divide-gray-200">
                        <!-- Table rows will be populated here -->
                    </tbody>
                </table>
            </div>

            <!-- Loading State -->
            <div id="payslipsLoading" class="text-center py-12 hidden">
                <div class="loading-spinner rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <p class="text-gray-500" data-translate="common.loading">Loading your payslips...</p>
            </div>

            <!-- Empty State -->
            <div id="payslipsEmpty" class="text-center py-12 hidden">
                <i class="fas fa-file-invoice text-6xl text-gray-300 mb-4"></i>
                <p class="text-gray-500" data-translate="message.no_data">No payslips available</p>
                <p class="text-sm text-gray-400" data-translate="salary.payslips">Your payslips will appear here once uploaded by HR</p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg border-l-4 p-4 max-w-sm">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i id="toastIcon" class="text-xl"></i>
                </div>
                <div class="ml-3">
                    <p id="toastMessage" class="text-sm font-medium text-gray-900"></p>
                </div>
                <div class="ml-auto pl-3">
                    <button onclick="hideToast()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentPayslips = [];
        let isLoading = false;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            if (!requireAuth()) return;
            
            initializePage();
            
            // Event listeners
            const logoutEl = document.getElementById('logoutBtn');
            if (logoutEl) logoutEl.addEventListener('click', handleLogout);
            document.getElementById('refreshBtn').addEventListener('click', loadPayslips);
            document.getElementById('filterMonth').addEventListener('change', applyFiltersAndRender);
            document.getElementById('filterYear').addEventListener('change', applyFiltersAndRender);
            
            // Language selector
            const languageSelector = document.getElementById('languageSelector');
            if (languageSelector) {
                languageSelector.value = currentLanguage || 'en';
                languageSelector.addEventListener('change', (e) => {
                    if (typeof setLanguage === 'function') {
                        setLanguage(e.target.value);
                    }
                });
            }
            
            // Initialize translations
            if (typeof updatePageTranslations === 'function') {
                updatePageTranslations();
            }
        });

        async function initializePage() {
            try {
                await loadPayslips();
            } catch (error) {
                console.error('Initialize page error:', error);
                showToast('error', 'Failed to initialize page');
            }
        }

        async function loadPayslips() {
            if (isLoading) return;
            
            try {
                isLoading = true;
                showPayslipsLoading();
                
                console.log('Applying filters', {
                    year: document.getElementById('filterYear').value,
                    month: document.getElementById('filterMonth').value
                });
                const qs = new URLSearchParams({
                    ...(document.getElementById('filterYear').value ? { year: document.getElementById('filterYear').value } : {}),
                    ...(document.getElementById('filterMonth').value ? { month: document.getElementById('filterMonth').value } : {})
                }).toString();
                console.log('Requesting payslips:', `http://localhost:3010/payslips/me${qs ? ('?' + qs) : ''}`);
                const response = await fetch(`http://localhost:3010/payslips/me${qs ? ('?' + qs) : ''}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('Employee record not found. Please contact HR.');
                    }
                    throw new Error('Failed to load payslips');
                }
                
                const data = await response.json();
                console.log('Payslips/me data:', data);
                currentPayslips = data.items || [];
                
                populateYearOptions(currentPayslips);
                // Default filters to current year on load
                const now = new Date();
                const yearSel = document.getElementById('filterYear');
                if ([...yearSel.options].some(o => o.value === String(now.getFullYear()))) {
                    yearSel.value = String(now.getFullYear());
                }
                applyFiltersAndRender();
                
            } catch (error) {
                console.error('Load payslips error:', error);
                showToast('error', error.message || 'Failed to load payslips');
                showPayslipsEmpty();
            } finally {
                isLoading = false;
                hidePayslipsLoading();
            }
        }
        
        function displayPayslips(payslips) {
            const tableBody = document.getElementById('myPayslipsBody');
            
            if (payslips.length === 0) {
                showPayslipsEmpty();
                return;
            }
            
            // Sort by year and month descending (newest first)
            payslips.sort((a, b) => {
                if (a.year !== b.year) return b.year - a.year;
                return b.month - a.month;
            });
            
            tableBody.innerHTML = payslips.map(payslip => {
                const statusClass = getStatusClass(payslip.status);
                const monthName = getMonthName(payslip.month);
                
                return `
                    <tr class="table-row">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${monthName}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${payslip.year}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="status-badge ${statusClass}">
                                ${getStatusText(payslip.status)}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${payslip.payslip_id ? 
                                `<a href="#" data-dl="${payslip.payslip_id}" class="text-blue-600 hover:text-blue-900 flex items-center">
                                    <i class="fas fa-download mr-2"></i>
                                    Download PDF
                                </a>` : 
                                '<span class="text-gray-400 italic">Not available</span>'
                            }
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Add download event listeners
            addDownloadEventListeners();
            hidePayslipsEmpty();
        }
        
        function applyFiltersAndRender() {
            const year = document.getElementById('filterYear').value;
            const month = document.getElementById('filterMonth').value;
            let filtered = [...currentPayslips];
            if (year) filtered = filtered.filter(p => String(p.year) === String(year));
            if (month) filtered = filtered.filter(p => String(p.month) === String(month));
            displayPayslips(filtered);
            updateSummary(filtered);
        }

        function populateYearOptions(payslips) {
            const select = document.getElementById('filterYear');
            const years = Array.from(new Set(payslips.map(p => p.year))).sort((a,b) => b - a);
            const currentVal = select.value;
            select.innerHTML = '<option value="">All</option>' + years.map(y => `<option value="${y}">${y}</option>`).join('');
            if (years.includes(parseInt(currentVal, 10))) select.value = currentVal;
        }
        
        function addDownloadEventListeners() {
            const tableBody = document.getElementById('myPayslipsBody');
            
            tableBody.querySelectorAll('a[data-dl]').forEach(a => {
                a.addEventListener('click', async (e) => {
                    e.preventDefault();
                    
                    try {
                        const payslipId = a.getAttribute('data-dl');
                        await downloadPayslip(payslipId);
                    } catch (error) {
                        console.error('Download error:', error);
                        showToast('error', 'Failed to download payslip');
                    }
                });
            });
        }

        async function downloadPayslip(payslipId) {
            try {
                const response = await fetch(`http://localhost:3010/payslips/download/${payslipId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to download payslip');
                }
                
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'payslip.pdf';
                document.body.appendChild(link);
                link.click();
                link.remove();
                URL.revokeObjectURL(url);
                
                showToast('success', 'Payslip downloaded successfully');
            } catch (error) {
                throw error;
            }
        }
        
        function updateSummary(payslips) {
            const total = payslips.length;
            const available = payslips.filter(p => p.payslip_id).length;
            const missing = total - available;
            
            document.getElementById('totalPayslips').textContent = total;
            document.getElementById('availablePayslips').textContent = available;
            document.getElementById('missingPayslips').textContent = missing;
        }

        // Utility functions
        function getStatusClass(status) {
            switch (status) {
                case 'uploaded': return 'status-uploaded';
                default: return 'status-not_uploaded';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'uploaded': return 'Available';
                default: return 'Not Available';
            }
        }
        
        function getMonthName(month) {
            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            return months[month - 1] || 'Unknown';
        }

        function showPayslipsLoading() {
            document.getElementById('payslipsLoading').classList.remove('hidden');
            document.getElementById('payslipsEmpty').classList.add('hidden');
        }

        function hidePayslipsLoading() {
            document.getElementById('payslipsLoading').classList.add('hidden');
        }

        function showPayslipsEmpty() {
            document.getElementById('payslipsEmpty').classList.remove('hidden');
            document.getElementById('payslipsLoading').classList.add('hidden');
        }

        function hidePayslipsEmpty() {
            document.getElementById('payslipsEmpty').classList.add('hidden');
        }

        function showToast(type, message) {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const messageEl = document.getElementById('toastMessage');
            
            // Set icon and colors based on type
            let iconClass, borderColor;
            switch (type) {
                case 'success':
                    iconClass = 'fas fa-check-circle text-green-600';
                    borderColor = 'border-green-600';
                    break;
                case 'error':
                    iconClass = 'fas fa-exclamation-circle text-red-600';
                    borderColor = 'border-red-600';
                    break;
                case 'warning':
                    iconClass = 'fas fa-exclamation-triangle text-yellow-600';
                    borderColor = 'border-yellow-600';
                    break;
                default:
                    iconClass = 'fas fa-info-circle text-blue-600';
                    borderColor = 'border-blue-600';
            }
            
            icon.className = iconClass;
            messageEl.textContent = message;
            toast.querySelector('div').className = `bg-white rounded-lg shadow-lg border-l-4 p-4 max-w-sm ${borderColor}`;
            
            toast.classList.remove('hidden');
            
            // Auto hide after 5 seconds
            setTimeout(hideToast, 5000);
        }

        function hideToast() {
            document.getElementById('toast').classList.add('hidden');
        }

        function handleLogout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userRole');
            window.location.href = '/frontend/pages/login.html';
        }

        function requireAuth() {
            const isLiveServer = ['5502','5503','5504'].includes(window.location.port);
            const token = localStorage.getItem('token');
            if (!token) {
                if (isLiveServer) {
                    localStorage.setItem('token', 'dev');
                    if (!localStorage.getItem('userRole')) localStorage.setItem('userRole', 'Employee');
                    showToast('warning', 'Dev bypass: mock token and Employee role set.');
                    return true;
                }
                window.location.href = '/frontend/pages/login.html';
                return false;
            }
            return true;
        }
    </script>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="../assets/js/translations.js"></script>
    <script src="../assets/js/navbar.js"></script>
</body>
</html>

            try {

                isLoading = true;

                showPayslipsLoading();

                console.log('Applying filters', {

                    year: document.getElementById('filterYear').value,

                    month: document.getElementById('filterMonth').value

                });

                const qs = new URLSearchParams({

                    ...(document.getElementById('filterYear').value ? { year: document.getElementById('filterYear').value } : {}),

                    ...(document.getElementById('filterMonth').value ? { month: document.getElementById('filterMonth').value } : {})

                }).toString();

                console.log('Requesting payslips:', `http://localhost:3010/payslips/me${qs ? ('?' + qs) : ''}`);

                const response = await fetch(`http://localhost:3010/payslips/me${qs ? ('?' + qs) : ''}`, {

                    headers: {

                        'Authorization': `Bearer ${localStorage.getItem('token')}`,

                        'Content-Type': 'application/json'

                    }

                });

                if (!response.ok) {

                    if (response.status === 404) {

                        throw new Error('Employee record not found. Please contact HR.');

                    }

                    throw new Error('Failed to load payslips');

                }

                const data = await response.json();

                console.log('Payslips/me data:', data);

                currentPayslips = data.items || [];

                populateYearOptions(currentPayslips);

                // Default filters to current year on load

                const now = new Date();

                const yearSel = document.getElementById('filterYear');

                if ([...yearSel.options].some(o => o.value === String(now.getFullYear()))) {

                    yearSel.value = String(now.getFullYear());

                }

                applyFiltersAndRender();

            } catch (error) {

                console.error('Load payslips error:', error);

                showToast('error', error.message || 'Failed to load payslips');

                showPayslipsEmpty();

            } finally {

                isLoading = false;

                hidePayslipsLoading();

            }

        }

        function displayPayslips(payslips) {

            const tableBody = document.getElementById('myPayslipsBody');

            if (payslips.length === 0) {

                showPayslipsEmpty();

                return;

            }

            // Sort by year and month descending (newest first)

            payslips.sort((a, b) => {

                if (a.year !== b.year) return b.year - a.year;

                return b.month - a.month;

            });

            tableBody.innerHTML = payslips.map(payslip => {

                const statusClass = getStatusClass(payslip.status);

                const monthName = getMonthName(payslip.month);

                return `

                    <tr class="table-row">

                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">

                            ${monthName}

                        </td>

                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">

                            ${payslip.year}

                        </td>

                        <td class="px-6 py-4 whitespace-nowrap">

                            <span class="status-badge ${statusClass}">

                                ${getStatusText(payslip.status)}

                            </span>

                        </td>

                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">

                            ${payslip.payslip_id ? 

                                `<a href="#" data-dl="${payslip.payslip_id}" class="text-blue-600 hover:text-blue-900 flex items-center">

                                    <i class="fas fa-download mr-2"></i>

                                    Download PDF

                                </a>` : 

                                '<span class="text-gray-400 italic">Not available</span>'

                            }

                        </td>

                    </tr>

                `;

            }).join('');

            // Add download event listeners

            addDownloadEventListeners();

            hidePayslipsEmpty();

        }

        function applyFiltersAndRender() {

            const year = document.getElementById('filterYear').value;

            const month = document.getElementById('filterMonth').value;

            let filtered = [...currentPayslips];

            if (year) filtered = filtered.filter(p => String(p.year) === String(year));

            if (month) filtered = filtered.filter(p => String(p.month) === String(month));

            displayPayslips(filtered);

            updateSummary(filtered);

        }

        function populateYearOptions(payslips) {

            const select = document.getElementById('filterYear');

            const years = Array.from(new Set(payslips.map(p => p.year))).sort((a,b) => b - a);

            const currentVal = select.value;

            select.innerHTML = '<option value="">All</option>' + years.map(y => `<option value="${y}">${y}</option>`).join('');

            if (years.includes(parseInt(currentVal, 10))) select.value = currentVal;

        }

        function addDownloadEventListeners() {

            const tableBody = document.getElementById('myPayslipsBody');

            tableBody.querySelectorAll('a[data-dl]').forEach(a => {

                a.addEventListener('click', async (e) => {

                    e.preventDefault();

                    try {

                        const payslipId = a.getAttribute('data-dl');

                        await downloadPayslip(payslipId);

                    } catch (error) {

                        console.error('Download error:', error);

                        showToast('error', 'Failed to download payslip');

                    }

                });

            });

        }

        async function downloadPayslip(payslipId) {

            try {

                const response = await fetch(`http://localhost:3010/payslips/download/${payslipId}`, {

                    headers: {

                        'Authorization': `Bearer ${localStorage.getItem('token')}`

                    }

                });

                if (!response.ok) {

                    throw new Error('Failed to download payslip');

                }

                const blob = await response.blob();

                const url = URL.createObjectURL(blob);

                const link = document.createElement('a');

                link.href = url;

                link.download = 'payslip.pdf';

                document.body.appendChild(link);

                link.click();

                link.remove();

                URL.revokeObjectURL(url);

                showToast('success', 'Payslip downloaded successfully');

            } catch (error) {

                throw error;

            }

        }

        function updateSummary(payslips) {

            const total = payslips.length;

            const available = payslips.filter(p => p.payslip_id).length;

            const missing = total - available;

            document.getElementById('totalPayslips').textContent = total;

            document.getElementById('availablePayslips').textContent = available;

            document.getElementById('missingPayslips').textContent = missing;

        }

        // Utility functions

        function getStatusClass(status) {

            switch (status) {

                case 'uploaded': return 'status-uploaded';

                default: return 'status-not_uploaded';

            }

        }

        function getStatusText(status) {

            switch (status) {

                case 'uploaded': return 'Available';

                default: return 'Not Available';

            }

        }

        function getMonthName(month) {

            const months = [

                'January', 'February', 'March', 'April', 'May', 'June',

                'July', 'August', 'September', 'October', 'November', 'December'

            ];

            return months[month - 1] || 'Unknown';

        }

        function showPayslipsLoading() {

            document.getElementById('payslipsLoading').classList.remove('hidden');

            document.getElementById('payslipsEmpty').classList.add('hidden');

        }

        function hidePayslipsLoading() {

            document.getElementById('payslipsLoading').classList.add('hidden');

        }

        function showPayslipsEmpty() {

            document.getElementById('payslipsEmpty').classList.remove('hidden');

            document.getElementById('payslipsLoading').classList.add('hidden');

        }

        function hidePayslipsEmpty() {

            document.getElementById('payslipsEmpty').classList.add('hidden');

        }

        function showToast(type, message) {

            const toast = document.getElementById('toast');

            const icon = document.getElementById('toastIcon');

            const messageEl = document.getElementById('toastMessage');

            // Set icon and colors based on type

            let iconClass, borderColor;

            switch (type) {

                case 'success':

                    iconClass = 'fas fa-check-circle text-green-600';

                    borderColor = 'border-green-600';

                    break;

                case 'error':

                    iconClass = 'fas fa-exclamation-circle text-red-600';

                    borderColor = 'border-red-600';

                    break;

                case 'warning':

                    iconClass = 'fas fa-exclamation-triangle text-yellow-600';

                    borderColor = 'border-yellow-600';

                    break;

                default:

                    iconClass = 'fas fa-info-circle text-blue-600';

                    borderColor = 'border-blue-600';

            }

            icon.className = iconClass;

            messageEl.textContent = message;

            toast.querySelector('div').className = `bg-white rounded-lg shadow-lg border-l-4 p-4 max-w-sm ${borderColor}`;

            toast.classList.remove('hidden');

            // Auto hide after 5 seconds

            setTimeout(hideToast, 5000);

        }

        function hideToast() {

            document.getElementById('toast').classList.add('hidden');

        }

        function handleLogout() {

            localStorage.removeItem('token');

            localStorage.removeItem('userRole');

            window.location.href = '/frontend/pages/login.html';

        }

        function requireAuth() {

            const isLiveServer = ['5502','5503'].includes(window.location.port);

            const token = localStorage.getItem('token');

            if (!token) {

                if (isLiveServer) {

                    localStorage.setItem('token', 'dev');

                    if (!localStorage.getItem('userRole')) localStorage.setItem('userRole', 'Employee');

                    showToast('warning', 'Dev bypass: mock token and Employee role set.');

                    return true;

                }

                window.location.href = '/frontend/pages/login.html';

                return false;

            }

            return true;

        }

    </script>

</body>

</html>

