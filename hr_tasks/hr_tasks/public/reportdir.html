<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="report.title">Interface Directeur - Rapports</title>
    <link rel="stylesheet" href="tailwind.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- Director-themed base styles (mirrored from director.html for consistency) --- */
        :root {
            --director-indigo: #4338ca;
            --director-blue: #2563eb;
            --director-purple: #7c3aed;
            --director-slate: #0f172a;
            --director-card-bg: #ffffff;
            --director-surface: #f8fafc;
        }

        body {
            font-family: 'Outfit', 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: var(--director-slate);
            background: radial-gradient(circle at top, rgba(59, 130, 246, 0.06), transparent 45%), #f5f7fb;
        }

        /* KPI cards & panels to visually match Director dashboard */
        .kpi-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.95));
            border-radius: 24px;
            padding: 22px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(15, 23, 42, 0.06);
            box-shadow: 0 18px 35px rgba(15, 23, 42, 0.07);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            flex: 1;
            min-width: 180px;
        }

        .kpi-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(37, 99, 235, 0.12), transparent 55%);
            pointer-events: none;
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 45px rgba(15, 23, 42, 0.12);
        }

        .kpi-icon {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(99, 102, 241, 0.35));
            color: #4338ca;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }

        .kpi-card p {
            position: relative;
            z-index: 1;
        }

        .kpi-card h3 {
            position: relative;
            z-index: 1;
        }

        .director-panel {
            margin-top: 16px;
            background: var(--director-card-bg);
            border-radius: 22px;
            padding: 24px 24px 20px;
            box-shadow: 0 24px 48px rgba(15, 23, 42, 0.08);
            border: 1px solid rgba(15, 23, 42, 0.06);
            position: relative;
            overflow: hidden;
        }

        .director-panel::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg,
                    rgba(37, 99, 235, 0.12),
                    rgba(124, 58, 237, 0.08),
                    rgba(56, 189, 248, 0.08));
            opacity: 0.25;
            pointer-events: none;
            z-index: 0;
        }

        .director-panel>* {
            position: relative;
            z-index: 1;
        }

        .director-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .director-panel-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .director-panel-title-icon {
            width: 32px;
            height: 32px;
            border-radius: 9999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at top left,
                    rgba(37, 99, 235, 0.22),
                    rgba(37, 99, 235, 0.05));
            color: #1d4ed8;
        }

        .director-section-pill {
            padding: 0.15rem 0.7rem;
            border-radius: 9999px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            background: rgba(15, 23, 42, 0.04);
            color: #64748b;
        }

        /* Existing local styles */
        .filter-button {
            padding: 0.5rem 1rem;
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.95));
            font-size: 0.8rem;
            font-weight: 600;
            color: #475569;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.06);
        }

        .filter-button:hover {
            background: linear-gradient(135deg, #e5edff, #dbeafe);
            border-color: #93c5fd;
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.15);
            transform: translateY(-2px);
        }

        .filter-button.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-color: #2563eb;
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }

        /* Status-specific pills */
        .filter-button[data-status="all"].active {
            background: linear-gradient(135deg, #e5e7eb, #e0f2fe);
            border-color: #9ca3af;
        }

        .filter-button[data-status="pending"].active {
            background: linear-gradient(135deg, #fef3c7, #facc15);
            border-color: #f59e0b;
            color: #92400e;
        }

        .filter-button[data-status="acknowledged"].active {
            background: linear-gradient(135deg, #dcfce7, #4ade80);
            border-color: #16a34a;
            color: #14532d;
        }

        /* Period-specific pills */
        .filter-button[data-period="all"].active {
            background: linear-gradient(135deg, #e0f2fe, #dbeafe);
            border-color: #60a5fa;
            color: #1d4ed8;
        }

        .filter-button[data-period="today"].active {
            background: linear-gradient(135deg, #fce7f3, #f472b6);
            border-color: #ec4899;
            color: #831843;
        }

        .filter-button[data-period="week"].active {
            background: linear-gradient(135deg, #ede9fe, #a855f7);
            border-color: #7c3aed;
            color: #4c1d95;
        }

        .filter-button[data-period="month"].active {
            background: linear-gradient(135deg, #e0f2fe, #38bdf8);
            border-color: #0ea5e9;
            color: #0f172a;
        }

        .report-card {
            transition: all 0.3s ease;
        }

        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .modal {
            backdrop-filter: blur(4px);
        }

        .modal-content {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-scroll {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 8px;
        }

        .modal-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .modal-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .modal-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .modal-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        #reportDetailsModal {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .acknowledge-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.3s ease;
        }

        .acknowledge-btn:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .acknowledged-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .report-type-tab {
            padding: 0.6rem 1.2rem;
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.95));
            font-size: 0.85rem;
            font-weight: 600;
            color: #475569;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .report-type-tab:hover {
            background: linear-gradient(135deg, #e5edff, #dbeafe);
            border-color: #93c5fd;
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.15);
            transform: translateY(-2px);
        }

        .report-type-tab.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-color: #2563eb;
            box-shadow: 0 12px 28px rgba(59, 130, 246, 0.35);
            transform: translateY(-2px);
        }

        .report-type-tab i {
            font-size: 0.8rem;
        }

        /* Filter field groups */
        .filter-field-group {
            padding: 1rem;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.95));
            border: 1px solid rgba(226, 232, 240, 0.8);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.06);
            transition: all 0.3s ease;
        }

        .filter-field-group:hover {
            border-color: rgba(59, 130, 246, 0.3);
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1);
        }

        .filter-field-group label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #64748b;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-field-group label i {
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .filter-select {
            border-radius: 12px;
            border: 1px solid #cbd5e1;
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
            background: #ffffff;
            color: #0f172a;
            outline: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .filter-select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
            background-color: #f9fafb;
        }

        .filter-select:hover {
            border-color: #94a3b8;
            background-color: #f8fafc;
        }

        .filter-date-input {
            border-radius: 9999px;
            border: 1px solid #cbd5e1;
            padding: 0.55rem 1rem;
            font-size: 0.8rem;
            background: #ffffff;
            color: #0f172a;
            outline: none;
            transition: border-color 0.16s ease, box-shadow 0.16s ease, background-color 0.16s ease;
        }

        .filter-date-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.35);
            background-color: #f9fafb;
        }

        /* Page Hero Styles */
        .page-hero {
            background: linear-gradient(135deg, #3b82f6 0%, #7c3aed 100%);
            color: white;
            border-radius: 28px;
            padding: 32px;
            position: sticky;
            top: 0;
            box-shadow: 0 25px 60px rgba(67, 56, 202, 0.25);
            margin-bottom: 2rem;
            z-index: 40;
        }

        .page-hero::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.25), transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .page-hero-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }


        .hero-chip {
            background: rgba(255, 255, 255, 0.18);
            border: 1px solid rgba(255, 255, 255, 0.35);
            color: white;
            padding: 10px 16px;
            border-radius: 999px;
            font-size: 0.82rem;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(10px);
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .hero-chip:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .hero-chip i {
            font-size: 0.9rem;
        }

        .hero-select {
            background: rgba(15, 23, 42, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            border-radius: 12px;
            padding: 10px 16px;
            min-width: 180px;
            backdrop-filter: blur(6px);
        }

        .hero-select option {
            background: #1e293b;
            color: white;
        }

        /* Animation for panel transitions */
        .animate-fadeIn {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Director Tabs Styling */
        .director-tab:hover {
            background: rgba(248, 250, 252, 0.8) !important;
            transform: translateY(-1px);
        }

        .director-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%) !important;
            color: white !important;
            font-weight: 600 !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25) !important;
            transform: translateY(-1px);
        }

        .director-tab.active i {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        /* Quick Action Buttons Styling */
        .quick-actions-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 24px 0;
            justify-content: flex-end;
        }

        .quick-action-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            min-width: 180px;
            height: 44px;
            flex: 0 0 auto;
        }

        .quick-action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .quick-action-btn.green {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .quick-action-btn.green:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .quick-action-btn.red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .quick-action-btn.red:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        .quick-action-btn.blue {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .quick-action-btn.blue:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }

        /* RTL Support for Arabic */
        [dir="rtl"] .quick-actions-container {
            justify-content: flex-start;
            direction: rtl;
        }

        [dir="rtl"] .quick-action-btn {
            direction: rtl;
        }

        [dir="rtl"] .quick-action-btn i {
            margin-left: 8px;
            margin-right: 0;
        }

        /* RTL Improvements for Filters */
        [dir="rtl"] .director-panel {
            direction: rtl;
        }

        [dir="rtl"] .director-panel .flex {
            flex-direction: row-reverse;
        }

        [dir="rtl"] .filter-field-group {
            text-align: right !important;
            direction: rtl !important;
        }

        [dir="rtl"] .filter-field-group label {
            text-align: right !important;
            display: block !important;
            direction: rtl !important;
        }

        [dir="rtl"] .report-type-tab i {
            margin-left: 0.5rem !important;
            margin-right: 0 !important;
        }

        [dir="rtl"] .filter-button {
            direction: rtl !important;
            text-align: right !important;
        }

        [dir="rtl"] .filter-date-input {
            direction: rtl !important;
            text-align: right !important;
        }

        [dir="rtl"] .relative .absolute {
            left: auto !important;
            right: 0.75rem !important;
        }

        [dir="rtl"] input[type="text"].w-full {
            padding-left: 0.75rem !important;
            padding-right: 2.25rem !important;
            text-align: right !important;
            direction: rtl !important;
        }

        [dir="rtl"] .grid {
            direction: rtl !important;
        }

        [dir="rtl"] .filter-select {
            direction: rtl !important;
            text-align: right !important;
        }

        [dir="rtl"] .flex-wrap {
            flex-direction: row-reverse !important;
        }

        [dir="rtl"] .text-gray-500 {
            direction: rtl !important;
            text-align: right !important;
        }

        /* Better spacing for Arabic */
        [dir="rtl"] .space-y-3>*+* {
            margin-top: 0.75rem !important;
            margin-bottom: 0 !important;
        }

        [dir="rtl"] .space-y-4>*+* {
            margin-top: 1rem !important;
            margin-bottom: 0 !important;
        }

        /* Specific fixes for filter layout */
        [dir="rtl"] .director-panel>div>div:first-child {
            order: 2;
        }

        [dir="rtl"] .director-panel>div>div:last-child {
            order: 1;
        }

        /* Improved Filter Structure Styles */
        .filter-section {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            transition: all 0.3s ease;
        }

        .filter-section:hover {
            background: rgba(255, 255, 255, 0.8);
            border-color: rgba(148, 163, 184, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .filter-section-header {
            margin-bottom: 16px;
        }

        .filter-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-section-content {
            min-height: 40px;
        }

        .filter-section-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .report-type-tabs {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .report-type-tabs .report-type-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            background: rgba(248, 250, 252, 0.8);
            color: #475569;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .report-type-tabs .report-type-tab:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: #2563eb;
        }

        .report-type-tabs .report-type-tab.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-color: #2563eb;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .filter-field-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-field-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            background: white;
            color: #374151;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .filter-button-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-button {
            padding: 6px 12px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            background: rgba(248, 250, 252, 0.8);
            color: #475569;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-button:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: #2563eb;
        }

        .filter-button.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-color: #2563eb;
        }

        .date-range-group {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-date-input {
            padding: 8px 12px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            background: white;
            color: #374151;
            font-size: 0.875rem;
            min-width: 140px;
        }

        .date-separator {
            color: #64748b;
            font-weight: 500;
        }

        .search-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            color: #64748b;
            font-size: 0.875rem;
            z-index: 1;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px 8px 36px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 6px;
            background: white;
            color: #374151;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* RTL for improved structure */
        [dir="rtl"] .filter-section-row {
            direction: rtl;
        }

        [dir="rtl"] .report-type-tabs {
            flex-direction: row-reverse;
        }

        [dir="rtl"] .filter-button-group {
            flex-direction: row-reverse;
        }

        [dir="rtl"] .date-range-group {
            flex-direction: row-reverse;
        }

        [dir="rtl"] .search-icon {
            left: auto;
            right: 12px;
        }

        [dir="rtl"] .search-input {
            padding: 8px 36px 8px 12px;
        }

        [dir="rtl"] .filter-grid {
            direction: rtl;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .filter-section-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            .report-type-tabs {
                flex-direction: column;
            }

            .filter-button-group {
                flex-direction: column;
            }

            .date-range-group {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* Reports List Card Styles */
        .report-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: rgba(59, 130, 246, 0.2);
        }

        .report-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 20px;
        }

        .report-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #0f172a;
            margin: 0 0 8px 0;
            line-height: 1.3;
        }

        .report-card-description {
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.5;
            margin: 0;
        }

        .report-card-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .report-meta-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(59, 130, 246, 0.04));
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 14px;
        }

        .report-meta-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .report-meta-content {
            flex: 1;
            min-width: 0;
        }

        .report-meta-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #3B82F6;
            margin: 0 0 4px 0;
            font-weight: 600;
        }

        .report-meta-value {
            font-size: 0.85rem;
            font-weight: 600;
            color: #0f172a;
            margin: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .report-card-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .report-action-btn {
            padding: 8px 12px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            color: #64748b;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .report-action-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: #2563eb;
        }

        .report-action-btn.primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-color: #2563eb;
        }

        .report-action-btn.primary:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }

        /* Report Table Styles */
        .report-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .report-table th {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            color: #374151;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.75rem;
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .report-table td {
            padding: 16px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.05);
            vertical-align: middle;
        }

        .report-table tr:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.02), rgba(59, 130, 246, 0.01));
        }

        /* RTL for reports */
        [dir="rtl"] .report-card-header {
            flex-direction: row-reverse;
        }

        [dir="rtl"] .report-card-actions {
            justify-content: flex-start;
        }

        [dir="rtl"] .report-table th,
        [dir="rtl"] .report-table td {
            text-align: right;
        }

        /* Report Details Modal Styles */
        .report-detail-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .report-detail-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: rgba(148, 163, 184, 0.2);
        }

        .report-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
        }

        .report-info-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(59, 130, 246, 0.02));
            border: 1px solid rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .report-info-card:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(59, 130, 246, 0.04));
            border-color: rgba(59, 130, 246, 0.2);
            transform: translateY(-1px);
        }

        .report-info-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
            font-size: 1.1rem;
        }

        .report-info-content {
            flex: 1;
            min-width: 0;
        }

        .report-info-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #64748b;
            margin: 0 0 4px 0;
            font-weight: 600;
        }

        .report-info-value {
            font-size: 0.95rem;
            font-weight: 600;
            color: #0f172a;
            margin: 0;
            line-height: 1.4;
        }

        .report-info-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 8px;
        }

        .report-info-action:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
        }

        .acknowledgement-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            color: #059669;
        }

        .acknowledgements-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .acknowledgements-list::-webkit-scrollbar {
            width: 6px;
        }

        .acknowledgements-list::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .acknowledgements-list::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .acknowledgements-list::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .acknowledgement-item {
            padding: 16px;
            background: white;
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .acknowledgement-item:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.02), rgba(59, 130, 246, 0.01));
            border-color: rgba(148, 163, 184, 0.2);
        }

        .acknowledgement-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .acknowledgement-status.acknowledged {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .acknowledgement-status.waiting {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        /* RTL for modal */
        [dir="rtl"] .report-detail-header {
            flex-direction: row-reverse;
        }

        [dir="rtl"] .report-info-card {
            flex-direction: row-reverse;
        }

        [dir="rtl"] .acknowledgement-item {
            direction: rtl;
        }

        /* Hero typography improvements */
        .page-hero h1 {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            line-height: 1.2;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .page-hero p {
            font-size: 1.125rem;
            font-weight: 400;
            line-height: 1.6;
        }

        /* Prevent header flicker on load */
        #reportHeader {
            opacity: 1;
            transition: opacity 0.1s ease;
        }

        #reportHeader.hidden-header {
            display: none !important;
            opacity: 0;
        }

        /* Report Stat Cards */
        .report-stat-card-inline {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.98));
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(15, 23, 42, 0.08);
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
            transition: all 0.3s ease;
            display: flex;
            gap: 16px;
            align-items: center;
            flex: 1;
            min-width: 200px;
        }

        .report-stat-card-inline:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(15, 23, 42, 0.12);
        }

        .report-stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .report-stat-content {
            flex: 1;
        }

        .report-stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .report-stat-value {
            font-size: 2.25rem;
            font-weight: 800;
            color: #0f172a;
            line-height: 1;
            margin-bottom: 10px;
        }

        .report-stat-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Quick Action Cards */
        .quick-action-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.98));
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(15, 23, 42, 0.08);
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
            transition: all 0.3s ease;
            display: flex;
            gap: 16px;
            align-items: center;
            flex: 1;
            min-width: 250px;
            text-decoration: none;
            cursor: pointer;
        }

        .quick-action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(15, 23, 42, 0.12);
            border-color: rgba(59, 130, 246, 0.2);
        }

        .quick-action-icon {
            width: 52px;
            height: 52px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.4rem;
            flex-shrink: 0;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .quick-action-title {
            font-size: 1rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 4px;
        }

        .quick-action-desc {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 500;
        }

        /* Timetable-card styles for reports */
        .timetable-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .timetable-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: #3B82F6;
        }

        .employee-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .department-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .timetable-card button,
        .timetable-card a {
            cursor: pointer;
        }

        .card-action-btn {
            width: 36px;
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }

        .card-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-download {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn-download:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }

        .btn-view {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-view:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .btn-acknowledge {
            background: linear-gradient(135deg, #a855f7, #7c3aed);
            color: white;
        }

        .btn-acknowledge:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
        }

        .btn-acknowledged {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            cursor: default;
        }

        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
            padding: 1.5rem;
        }

        .pagination-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid #e5e7eb;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }

        /* Header User Section Styles */
        .header-user-section {
            display: flex;
            align-items: center;
            gap: 16px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 12px 18px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            transition: all 0.3s ease;
        }

        .header-user-section:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .header-avatar {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, #ffffff, #f1f5f9);
            color: #4338ca;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .header-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 14px;
            object-fit: cover;
        }

        .header-user-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 0;
        }

        .header-user-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: #ffffff;
            margin: 0;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .header-user-role {
            font-size: 0.75rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.85);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: rgba(255, 255, 255, 0.15);
            padding: 4px 10px;
            border-radius: 8px;
            display: inline-block;
            width: fit-content;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .notification-bell {
            position: relative;
            width: 48px;
            height: 48px;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #ffffff;
            font-size: 1.2rem;
        }

        .notification-bell:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .notification-bell:active {
            transform: translateY(0);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .notification-badge:empty {
            display: none;
        }

        .header-date {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 12px 18px;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            color: #ffffff;
            font-size: 0.9rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .header-date i {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Notification Dropdown Styles */
        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 12px;
            width: 420px;
            max-width: 95vw;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(0, 0, 0, 0.08);
            z-index: 1000;
            overflow: hidden;
            animation: dropdownFadeIn 0.2s ease-out;
        }

        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notification-dropdown.hidden {
            display: none;
        }

        .notification-dropdown-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        }

        .notification-dropdown-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            font-weight: 700;
            color: #0f172a;
            margin: 0;
        }

        .notification-dropdown-title i {
            color: #3b82f6;
            font-size: 1.1rem;
        }

        .mark-all-read-btn {
            background: transparent;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .mark-all-read-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .notification-list::-webkit-scrollbar {
            width: 6px;
        }

        .notification-list::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .notification-list::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .notification-list::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .notification-loading,
        .notification-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            gap: 12px;
            color: #64748b;
        }

        .notification-empty i {
            font-size: 3rem;
            color: #cbd5e1;
        }

        .notification-empty p {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .notification-item {
            display: flex;
            gap: 12px;
            padding: 14px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: inherit;
        }

        .notification-item:hover {
            background: #f8fafc;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item.unread {
            background: rgba(59, 130, 246, 0.04);
        }

        .notification-item.unread::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #3b82f6;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1rem;
            color: white;
        }

        .notification-icon.task {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .notification-icon.report {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .notification-icon.complaint {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .notification-icon.signal {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .notification-message {
            font-size: 0.8rem;
            color: #64748b;
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .notification-time {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .notification-time i {
            font-size: 0.7rem;
        }

        .notification-dropdown-footer {
            padding: 12px 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            background: #f8fafc;
        }

        .view-all-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #3b82f6;
            font-size: 0.85rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .view-all-link:hover {
            color: #2563eb;
            gap: 12px;
        }

        .view-all-link i {
            font-size: 0.75rem;
            transition: transform 0.2s ease;
        }

        .view-all-link:hover i {
            transform: translateX(4px);
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .header-user-section {
                padding: 10px 14px;
            }

            .header-avatar {
                width: 48px;
                height: 48px;
                font-size: 1.2rem;
            }

            .header-user-name {
                font-size: 1rem;
            }

            .header-date {
                padding: 10px 14px;
                font-size: 0.85rem;
            }

            .report-stat-card-inline {
                min-width: 180px;
                padding: 16px;
            }

            .quick-action-card {
                min-width: 200px;
                padding: 16px;
            }
        }

        @media (max-width: 640px) {
            .header-user-section {
                flex: 1;
                min-width: 0;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .header-date span {
                display: none;
            }

            .header-date {
                padding: 12px;
                width: 48px;
                height: 48px;
                justify-content: center;
            }

            .report-stat-card-inline {
                min-width: 100%;
                padding: 14px;
                gap: 12px;
            }

            .report-stat-icon {
                width: 48px;
                height: 48px;
                font-size: 1.2rem;
            }

            .report-stat-value {
                font-size: 1.8rem;
            }

            .quick-action-card {
                min-width: 100%;
                padding: 14px;
                gap: 12px;
            }

            .quick-action-icon {
                width: 48px;
                height: 48px;
                font-size: 1.2rem;
            }

            .filter-field-group {
                padding: 0.75rem;
            }

            .filter-button {
                padding: 0.4rem 0.8rem;
                font-size: 0.75rem;
            }

            .report-type-tab {
                padding: 0.5rem 1rem;
                font-size: 0.75rem;
            }

            /* Responsive tabs for mobile */
            .director-tabs {
                flex-direction: column !important;
                gap: 4px !important;
                width: 100% !important;
            }

            .director-tab {
                width: 100% !important;
                justify-content: center !important;
                padding: 10px 16px !important;
                font-size: 0.8rem !important;
            }

            .notification-dropdown {
                position: fixed;
                top: auto;
                right: 0;
                left: 0;
                bottom: 0;
                margin: 0;
                width: 100%;
                max-width: 100%;
                border-radius: 16px 16px 0 0;
                max-height: 80vh;
            }

            .notification-list {
                max-height: calc(80vh - 140px);
            }
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 0.75rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .page-title i {
            color: #3b82f6;
            font-size: 1.75rem;
        }

        .page-subtitle {
            font-size: 1rem;
            color: #64748b;
            margin: 0;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 1.5rem;
                flex-direction: column;
                gap: 0.5rem;
            }

            .page-title i {
                font-size: 1.5rem;
            }

            .page-subtitle {
                font-size: 0.875rem;
            }
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b hidden-header" id="reportHeader">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="h-10 w-10 bg-purple-600 rounded-full flex items-center justify-center text-white">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-gray-900" data-translate="nav.director_dashboard">
                            Interface Directeur</h1>
                        <p class="text-gray-500 text-sm" data-translate="report.description">Gestion des rapports
                            d'activit</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Language Selector -->
                    <select id="languageSelector"
                        class="bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="en">English</option>
                        <option value="fr">Franais</option>
                        <option value="ar"></option>
                    </select>
                    <div class="text-sm text-gray-600">
                        <span id="currentUser">Directeur</span>
                    </div>
                    <button onclick="window.history.back()"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i><span data-translate="report.back">Retour</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="w-full p-6">
        <!-- Page Title & Description -->
        <div class="page-header">
            <h1 class="page-title" data-translate="report.title">
                <i class="fas fa-file-alt"></i>
                Interface Directeur - Rapports
            </h1>
            <p class="page-subtitle" data-translate="report.description">Gestion des rapports d'activit</p>
        </div>

        <!-- Director Toolbar with Tabs -->
        <div class="director-toolbar mt-8"
            style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.98)); border-radius: 20px; padding: 24px; border: 1px solid rgba(15, 23, 42, 0.08); box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08); position: relative; overflow: hidden; margin-bottom: 2rem;">
            <div
                style="position: absolute; inset: 0; background: linear-gradient(120deg, rgba(37, 99, 235, 0.05), rgba(124, 58, 237, 0.03), rgba(56, 189, 248, 0.03)); opacity: 0.5; pointer-events: none;">
            </div>
            <div
                style="display: flex; align-items: center; justify-content: center; gap: 20px; position: relative; z-index: 1; flex-wrap: wrap;">
                <nav class="director-tabs" aria-label="Report views" id="reportTabs"
                    style="display: inline-flex; flex-wrap: wrap; gap: 8px; background: rgba(248, 250, 252, 0.6); padding: 6px; border-radius: 16px; border: 1px solid rgba(148, 163, 184, 0.15);">
                    <button data-tab="rapport" id="tab-rapport" class="director-tab active"
                        style="border-radius: 12px; padding: 12px 20px; border: none; background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%); color: white; font-weight: 600; font-size: 0.875rem; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25); transform: translateY(-1px);">
                        <i class="fas fa-file-alt" style="font-size: 1rem; color: rgba(255, 255, 255, 0.9);"></i>
                        <span data-translate="report.tab_reports">Reports</span>
                    </button>
                    <button data-tab="priority" id="tab-priority" class="director-tab"
                        style="border-radius: 12px; padding: 12px 20px; border: none; background: transparent; color: #475569; font-weight: 500; font-size: 0.875rem; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 1rem; color: #64748b;"></i>
                        <span data-translate="report.tab_priorities">Priorities</span>
                    </button>
                    <button data-tab="statistics" id="tab-statistics" class="director-tab"
                        style="border-radius: 12px; padding: 12px 20px; border: none; background: transparent; color: #475569; font-weight: 500; font-size: 0.875rem; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
                        <i class="fas fa-chart-bar" style="font-size: 1rem; color: #64748b;"></i>
                        <span data-translate="report.tab_statistics">Statistics</span>
                    </button>
                </nav>
            </div>
        </div>

        <!-- Tab Panels -->
        <div id="panel-rapport" class="space-y-6 animate-fadeIn">
            <!-- Reports Statistics -->
            <div class="flex flex-wrap gap-4 justify-between">
                <div class="report-stat-card-inline !p-3 !gap-3 !min-w-0 !border-t-4 !border-blue-600 bg-blue-50">
                    <div class="report-stat-icon" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <div class="report-stat-content">
                        <p class="report-stat-label" data-translate="report.total_reports">Total Reports</p>
                        <h3 id="totalReports" class="report-stat-value">0</h3>
                        <span class="report-stat-badge" style="background: rgba(59, 130, 246, 0.1); color: #2563eb;">
                            <span data-translate="report.all_reports">All reports</span>
                        </span>
                    </div>
                </div>

                <div class="report-stat-card-inline !p-3 !gap-3 !min-w-0 !border-t-4 !border-emerald-500 bg-emerald-50">
                    <div class="report-stat-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="report-stat-content">
                        <p class="report-stat-label" data-translate="report.acknowledged">Acknowledged</p>
                        <h3 id="acknowledgedReports" class="report-stat-value" style="color: #059669;">0</h3>
                        <span class="report-stat-badge" style="background: rgba(16, 185, 129, 0.1); color: #059669;">
                            <span data-translate="report.confirmed_reports">Confirmed</span>
                        </span>
                    </div>
                </div>

                <div class="report-stat-card-inline !p-3 !gap-3 !min-w-0 !border-t-4 !border-yellow-500 bg-yellow-50">
                    <div class="report-stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="report-stat-content">
                        <p class="report-stat-label" data-translate="report.pending">Pending</p>
                        <h3 id="pendingReports" class="report-stat-value" style="color: #d97706;">0</h3>
                        <span class="report-stat-badge" style="background: rgba(245, 158, 11, 0.1); color: #d97706;">
                            <span data-translate="report.requires_action">Requires action</span>
                        </span>
                    </div>
                </div>

                <div class="report-stat-card-inline !p-3 !gap-3 !min-w-0 !border-t-4 !border-purple-600 bg-purple-50">
                    <div class="report-stat-icon" style="background: linear-gradient(135deg, #a855f7, #7c3aed);">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="report-stat-content">
                        <p class="report-stat-label" data-translate="report.today">Today</p>
                        <h3 id="todayReports" class="report-stat-value" style="color: #7c3aed;">0</h3>
                        <span class="report-stat-badge" style="background: rgba(168, 85, 247, 0.1); color: #7c3aed;">
                            <span data-translate="report.todays_reports">Today's reports</span>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions-container" id="quickActionsContainer">
                <button id="acknowledgeAllBtn" class="quick-action-btn green">
                    <i class="fas fa-check-double"></i>
                    <span data-translate="report.acknowledge_all_pending">Acknowledge All Pending</span>
                </button>

                <a href="priorities.html" class="quick-action-btn red">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span data-translate="report.view_priorities">View Priorities</span>
                </a>

                <button onclick="exportReports()" class="quick-action-btn blue">
                    <i class="fas fa-download"></i>
                    <span data-translate="report.export_reports">Export Reports</span>
                </button>
            </div>

            <!-- Filtres -->
            <div class="director-panel">
                <div class="director-panel-header">
                    <div class="director-panel-title">
                        <div class="director-panel-title-icon">
                            <i class="fas fa-filter"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900" data-translate="report.filters">Filtres</h3>
                            <p class="text-xs text-gray-500 mt-0.5" data-translate="report.refine_view">Affinez la vue
                                des rapports selon vos besoins</p>
                        </div>
                    </div>
                    <span class="director-section-pill" data-translate="report.advanced_view">Vue avance</span>
                </div>

                <div class="p-6 space-y-6">
                    <!-- Report Type Section -->
                    <div class="filter-section">
                        <div class="filter-section-header">
                            <h4 class="filter-section-title" data-translate="report.report_type">Type de Rapport</h4>
                        </div>
                        <div class="filter-section-content">
                            <div class="report-type-tabs">
                                <button class="report-type-tab active" data-type="all"
                                    onclick="selectReportType('all')">
                                    <i class="fas fa-list"></i>
                                    <span data-translate="report.all_reports">Tous les rapports</span>
                                </button>
                                <button class="report-type-tab" data-type="employee"
                                    onclick="selectReportType('employee')">
                                    <i class="fas fa-user"></i>
                                    <span data-translate="report.employee_reports">Rapports Employs</span>
                                </button>
                                <button class="report-type-tab" data-type="responsible"
                                    onclick="selectReportType('responsible')">
                                    <i class="fas fa-user-tie"></i>
                                    <span data-translate="report.responsible_reports">Rapports Responsables</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Dynamic Filters Section -->
                    <div class="filter-section">
                        <div class="filter-section-header">
                            <h4 class="filter-section-title" data-translate="report.specific_filters">Filtres
                                spcifiques</h4>
                        </div>
                        <div class="filter-section-content">
                            <div id="filterContainer">
                                <!-- Filtres pour "Tous les rapports" -->
                                <div id="allReportsFilters" class="filter-grid">
                                    <div class="filter-field-group">
                                        <label data-translate="report.department">Dpartement</label>
                                        <select class="filter-select" id="departmentFilter"
                                            onchange="loadDepartmentData()">
                                            <option value="all" data-translate="report.all_departments">Tous les
                                                dpartements</option>
                                        </select>
                                    </div>
                                    <div class="filter-field-group">
                                        <label data-translate="report.employee">Employ</label>
                                        <select class="filter-select" id="employeeFilter" onchange="applyFilters()">
                                            <option value="all" data-translate="report.all_employees">Tous les employs
                                            </option>
                                        </select>
                                    </div>
                                    <div class="filter-field-group">
                                        <label data-translate="report.responsible">Responsable</label>
                                        <select class="filter-select" id="responsibleFilter" onchange="applyFilters()">
                                            <option value="all" data-translate="report.all_responsibles">Tous les
                                                responsables</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Filtres pour "Rapports Employs" -->
                                <div id="employeeReportsFilters" class="filter-grid" style="display: none;">
                                    <div class="filter-field-group">
                                        <label>Dpartement</label>
                                        <select class="filter-select" id="employeeDeptFilter"
                                            onchange="loadEmployeeDepartmentData()">
                                            <option value="all">Tous les dpartements</option>
                                        </select>
                                    </div>
                                    <div class="filter-field-group">
                                        <label>Employ</label>
                                        <select class="filter-select" id="employeeOnlyFilter" onchange="applyFilters()">
                                            <option value="all">Tous les employs</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Filtres pour "Rapports Responsables" -->
                                <div id="responsibleReportsFilters" class="filter-grid" style="display: none;">
                                    <div class="filter-field-group">
                                        <label>Dpartement</label>
                                        <select class="filter-select" id="responsibleDeptFilter"
                                            onchange="loadResponsibleDepartmentData()">
                                            <option value="all">Tous les dpartements</option>
                                        </select>
                                    </div>
                                    <div class="filter-field-group">
                                        <label>Responsable</label>
                                        <select class="filter-select" id="responsibleOnlyFilter"
                                            onchange="applyFilters()">
                                            <option value="all">Tous les responsables</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status and Period Section -->
                    <div class="filter-section-row">
                        <!-- Status Filters -->
                        <div class="filter-section">
                            <div class="filter-section-header">
                                <h4 class="filter-section-title" data-translate="report.status">Statut</h4>
                            </div>
                            <div class="filter-section-content">
                                <div class="filter-button-group">
                                    <button class="filter-button active" data-status="all"
                                        onclick="selectFilter('status', 'all')"
                                        data-translate="report.all">Tous</button>
                                    <button class="filter-button" data-status="pending"
                                        onclick="selectFilter('status', 'pending')" data-translate="report.pending">En
                                        Attente</button>
                                    <button class="filter-button" data-status="acknowledged"
                                        onclick="selectFilter('status', 'acknowledged')"
                                        data-translate="report.acknowledged">Accuss</button>
                                </div>
                            </div>
                        </div>

                        <!-- Period Filters -->
                        <div class="filter-section">
                            <div class="filter-section-header">
                                <h4 class="filter-section-title" data-translate="report.quick_period">Priode rapide
                                </h4>
                            </div>
                            <div class="filter-section-content">
                                <div class="filter-button-group">
                                    <button class="filter-button active" data-period="all"
                                        onclick="selectFilter('period', 'all')"
                                        data-translate="report.all_periods">Toutes Priodes</button>
                                    <button class="filter-button" data-period="today"
                                        onclick="selectFilter('period', 'today')"
                                        data-translate="report.today">Aujourd'hui</button>
                                    <button class="filter-button" data-period="week"
                                        onclick="selectFilter('period', 'week')" data-translate="report.this_week">Cette
                                        Semaine</button>
                                    <button class="filter-button" data-period="month"
                                        onclick="selectFilter('period', 'month')" data-translate="report.this_month">Ce
                                        Mois</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Period and Search Section -->
                    <div class="filter-section-row">
                        <!-- Custom Period -->
                        <div class="filter-section">
                            <div class="filter-section-header">
                                <h4 class="filter-section-title" data-translate="report.custom_period">Priode
                                    personnalise</h4>
                            </div>
                            <div class="filter-section-content">
                                <div class="date-range-group">
                                    <input id="customStart" type="date" class="filter-date-input" />
                                    <span class="date-separator"></span>
                                    <input id="customEnd" type="date" class="filter-date-input" />
                                    <button class="filter-button" type="button" onclick="applyCustomDateRange()"
                                        data-translate="report.apply">Appliquer</button>
                                </div>
                            </div>
                        </div>

                        <!-- Search -->
                        <div class="filter-section">
                            <div class="filter-section-header">
                                <h4 class="filter-section-title" data-translate="report.search">Recherche</h4>
                            </div>
                            <div class="filter-section-content">
                                <div class="search-input-group">
                                    <i class="fas fa-search search-icon"></i>
                                    <input id="textSearch" type="text"
                                        data-translate-placeholder="report.search_placeholder"
                                        placeholder="Rechercher (titre, objet, destinataire, contenu, employ, dpartement)"
                                        class="search-input" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Liste des rapports -->
            <div class="director-panel">
                <div class="p-6 border-b">
                    <div class="flex items-center justify-between gap-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900" data-translate="report.reports">Rapports
                            </h3>
                            <p class="text-gray-600 text-sm" data-translate="report.manage_reports">Grer et suivre tous
                                les rapports</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="flex items-center space-x-2">
                                <button id="reportsSortToggle"
                                    class="p-2 rounded-lg bg-gray-100 text-gray-600 transition-colors"
                                    title="Toggle Sort">
                                    <i class="fas fa-sort-alpha-down" id="reportsSortIcon"></i>
                                </button>
                                <button id="reportsViewModeCards"
                                    class="p-2 rounded-lg transition-colors bg-gray-100 text-gray-600"
                                    title="Cards View">
                                    <i class="fas fa-border-all"></i>
                                </button>
                                <button id="reportsViewModeList" class="p-2 rounded-lg transition-colors"
                                    title="List View">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full"
                                id="reportsCount">0</span>
                        </div>
                    </div>
                </div>
                <div id="reportsList" class="p-6">
                    <!-- Reports will be loaded here -->
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p data-translate="report.no_reports">Aucun rapport trouv</p>
                    </div>
                </div>

                <!-- Pagination Controls -->
                <div id="reportsPagination" class="flex justify-center items-center space-x-4 mt-6 px-6 pb-6">
                    <button id="reportsPrevBtn"
                        class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                        disabled>
                        <i class="fas fa-chevron-left mr-2"></i>
                        <span data-translate="common.previous">Previous</span>
                    </button>
                    <span id="reportsPageInfo" class="text-sm text-gray-600">
                        Page <span id="reportsCurrentPage">1</span> of <span id="reportsTotalPages">1</span>
                    </span>
                    <button id="reportsNextBtn"
                        class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <span data-translate="common.next">Next</span>
                        <i class="fas fa-chevron-right ml-2"></i>
                    </button>
                </div>
            </div>
            <!-- Pagination -->
            <div id="paginationContainer" class="pagination-container" style="display: none;">
                <button id="prevPageBtn" onclick="previousPage()" class="pagination-btn bg-white text-gray-700">
                    <i class="fas fa-chevron-left mr-2"></i><span data-translate="report.previous">Previous</span>
                </button>
                <div class="flex items-center gap-4">
                    <span id="currentPageNum" class="pagination-info">Page 1 of 1</span>
                    <span id="paginationInfo" class="pagination-info">Showing 1-10 of 0</span>
                </div>
                <button id="nextPageBtn" onclick="nextPage()" class="pagination-btn bg-white text-gray-700">
                    <span data-translate="report.next">Next</span><i class="fas fa-chevron-right ml-2"></i>
                </button>
            </div>
        </div>
        </div>
        </div>

        <!-- Priority Panel (iframe) -->
        <div id="panel-priority" class="hidden space-y-6 animate-fadeIn">
            <iframe src="priorities.html" class="w-full rounded-lg border-0"
                style="overflow: hidden; display: block; background: transparent; height: auto; min-height: 2000px;"></iframe>
        </div>

        <!-- Statistics Panel (iframe) -->
        <div id="panel-statistics" class="hidden space-y-6 animate-fadeIn">
            <iframe src="statistics.html" class="w-full rounded-lg border-0"
                style="overflow: hidden; display: block; background: transparent; height: auto; min-height: 2000px;"></iframe>
        </div>
    </main>

    <!-- Enhanced Modal de dtails du rapport -->
    <div id="reportDetailsModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50 p-4">
        <div class="modal-shell max-w-4xl w-full transition-all"
            style="max-height:85vh; display: flex; flex-direction: column;">
            <div class="flex items-center justify-between p-6 bg-white border-b border-gray-200">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg">
                        <i class="fas fa-eye" style="color: white; font-size: 1rem;"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900" data-translate="report.report_details">Dtails du
                        Rapport</h3>
                </div>
                <button onclick="closeReportDetails()"
                    class="w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-all">
                    <i class="fas fa-times text-gray-600"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 custom-scrollbar bg-white">
                <div id="modalContent" class="space-y-6">
                    <!-- Contenu charg dynamiquement -->
                </div>
            </div>
            <div class="flex justify-end gap-3 p-6 border-t border-slate-100 bg-slate-50">
                <button id="modalAcknowledgeBtn" class="btn-primary hidden" style="display: none;">
                    <i class="fas fa-check mr-2"></i>
                    <span data-translate="report.acknowledge_receipt">Accuser Rception</span>
                </button>
            </div>
        </div>
    </div>
    <script src="auth.js"></script>
    <script src="translations.js"></script>

    <script>
        // Align API base with director workspace behavior (supports embed + main app config)
        const API = (function () {
            try {
                // Prefer parent API_BASE when embedded in main app
                if (window.parent && window.parent !== window && window.parent.API_BASE) {
                    return window.parent.API_BASE;
                }
                // Fallback to window-scoped API_BASE if defined
                if (window.API_BASE) {
                    return window.API_BASE;
                }
                const origin = (window.location && window.location.origin) || '';
                const hostname = (window.location && window.location.hostname) || '';
                const port = window.location.port || '';
                const portNumber = parseInt(port, 10);
                const isLiveServerPort = !Number.isNaN(portNumber) && portNumber >= 5500 && portNumber <= 5599;
                const isLocalHost = /^(127\.0\.0\.1|localhost)$/i.test(hostname || '');
                if ((isLocalHost && isLiveServerPort) || !origin || !/^https?:\/\//i.test(origin)) {
                    // Use same hostname as current page to avoid CORS issues
                    const apiHost = hostname === '127.0.0.1' ? '127.0.0.1' : 'localhost';
                    return `http://${apiHost}:3020`;
                }
                return origin;
            } catch (_) {
                return 'http://localhost:3020';
            }
        })();

        console.log(' API Base URL:', API);
        console.log(' Window location:', {
            origin: window.location.origin,
            hostname: window.location.hostname,
            port: window.location.port,
            pathname: window.location.pathname,
            search: window.location.search
        });
        console.log(' Parent window info:', {
            hasParent: window.parent !== window,
            parentAPI: window.parent && window.parent !== window ? window.parent.API_BASE : 'N/A',
            parentAuthManager: window.parent && window.parent !== window ? !!window.parent.authManager : false
        });

        // Reuse the same auth header helper as director workspace
        function getAuthHeaders() {
            try {
                console.log(' Getting auth headers...');

                const authToken = (function () {
                    // First: parent window's authManager (when embedded in main app)
                    try {
                        if (window.parent && window.parent !== window && window.parent.authManager) {
                            console.log(' Trying parent window authManager...');
                            const token = window.parent.authManager.getToken();
                            if (token) {
                                console.log(' Got token from parent authManager:', token.substring(0, 20) + '...');
                                // Sync to localStorage for fallback
                                localStorage.setItem('token', token);
                                return token;
                            } else {
                                console.warn(' Parent authManager exists but no token');
                            }
                        } else {
                            console.log(' No parent authManager available');
                        }
                    } catch (e) {
                        console.warn(' Could not access parent authManager:', e.message);
                    }

                    // Second: local authManager from hr_tasks/auth.js
                    if (typeof authManager !== 'undefined' && authManager && authManager.getToken) {
                        console.log(' Trying local authManager...');
                        const token = authManager.getToken();
                        if (token) {
                            console.log(' Got token from local authManager:', token.substring(0, 20) + '...');
                            return token;
                        } else {
                            console.warn(' Local authManager exists but no token');
                        }
                    } else {
                        console.log(' No local authManager available');
                    }

                    // Third: bare token from localStorage
                    const localToken = localStorage.getItem('token');
                    if (localToken) {
                        console.log(' Got token from localStorage:', localToken.substring(0, 20) + '...');
                        return localToken;
                    } else {
                        console.warn(' No token in localStorage');
                    }

                    // Fourth: Try to get user info from parent and create a mock token
                    try {
                        if (window.parent && window.parent !== window && window.parent.authManager) {
                            const user = window.parent.authManager.getUser();
                            if (user && user.role === 'Director') {
                                console.log(' Creating mock token for Director user');
                                // Create a simple mock token for testing
                                const mockToken = 'director-mock-token-' + Date.now();
                                localStorage.setItem('token', mockToken);
                                return mockToken;
                            }
                        }
                    } catch (e) {
                        console.warn(' Could not create mock token:', e.message);
                    }

                    console.warn(' No authentication token available');
                    return null;
                })();

                const headers = authToken ? {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                } : {
                    'Content-Type': 'application/json'
                };

                console.log(' Final headers:', { hasAuth: !!authToken, headers: Object.keys(headers) });
                return headers;
            } catch (error) {
                console.error(' Error getting auth headers:', error);
                return { 'Content-Type': 'application/json' };
            }
        }
        let currentUser = null;
        let reports = [];
        let departments = [];
        let employees = [];
        let responsibles = [];
        let currentFilters = {
            type: 'all',
            department_id: 'all',
            employee_id: 'all',
            responsible_id: 'all',
            status: 'all',
            period: 'all'
        };
        let departmentEmployees = new Map(); // Cache pour les employs par dpartement
        let departmentResponsibles = new Map(); // Cache pour les responsables par dpartement
        const UUID_REGEX = /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/;

        // Pagination variables
        let currentPage = 1;
        let itemsPerPage = 10;

        // Function to update placeholders with translations
        function updatePlaceholders() {
            const elementsWithPlaceholder = document.querySelectorAll('[data-translate-placeholder]');
            elementsWithPlaceholder.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (typeof translate === 'function') {
                    element.placeholder = translate(key);
                }
            });
        }

        // Function to refresh dynamic dropdowns with new language
        function refreshDynamicDropdowns() {
            // Refresh department dropdowns
            const allDeptText = typeof translate === 'function' ? translate('report.all_departments') : 'Tous les dpartements';
            const employeesText = typeof translate === 'function' ? translate('report.employees_count') : 'employs';

            const departmentSelects = ['departmentFilter', 'employeeDeptFilter', 'responsibleDeptFilter'];
            departmentSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select && departments.length > 0) {
                    const currentValue = select.value;
                    select.innerHTML = `<option value="all">${allDeptText}</option>`;
                    departments.forEach(dept => {
                        const option = new Option(`${dept.name} (${dept.employee_count} ${employeesText})`, dept.id);
                        select.add(option);
                    });
                    select.value = currentValue;
                }
            });

            // Refresh employee and responsible dropdowns
            populateAllEmployeesAndResponsibles();
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', async function () {
            console.log(' DOMContentLoaded fired in reportdir.html');

            // Check if we're in an iframe to prevent parent window redirects
            const isInIframe = window.self !== window.top;
            console.log(' Is in iframe:', isInIframe);

            // Respect authentication, but prevent redirects when embedded
            if (typeof requireAuth === 'function' && !isInIframe) {
                console.log(' Checking authentication (not in iframe)');
                const ok = requireAuth();
                if (!ok) {
                    console.log(' Authentication failed, stopping initialization');
                    return;
                }
            } else if (isInIframe) {
                console.log(' Skipping requireAuth check - running in iframe (parent handles auth)');
            } else {
                console.log(' requireAuth function not available');
            }

            // If embedded inside the main platform, hide local header for seamless layout
            const headerEl = document.getElementById('reportHeader');
            try {
                const params = new URLSearchParams(window.location.search);
                const isEmbed = params.get('embed') === '1' || (function () {
                    try { return window.self !== window.top; } catch (_) { return true; }
                })();

                if (!isEmbed && headerEl) {
                    // Show header if not embedded
                    headerEl.classList.remove('hidden-header');
                }
                // If embedded, header stays hidden (has hidden-header class by default)
            } catch (_) {
                // On error, show header
                if (headerEl) {
                    headerEl.classList.remove('hidden-header');
                }
            }

            // Language selector
            const languageSelector = document.getElementById('languageSelector');
            if (languageSelector) {
                const savedLang = localStorage.getItem('preferredLanguage') || 'en';
                languageSelector.value = savedLang;

                // Update HTML lang and dir attributes
                document.documentElement.lang = savedLang === 'ar' ? 'ar' : savedLang === 'fr' ? 'fr' : 'en';
                document.documentElement.dir = savedLang === 'ar' ? 'rtl' : 'ltr';

                languageSelector.addEventListener('change', (e) => {
                    const selectedLang = e.target.value;
                    localStorage.setItem('preferredLanguage', selectedLang);

                    // Update HTML lang and dir attributes
                    document.documentElement.lang = selectedLang === 'ar' ? 'ar' : selectedLang === 'fr' ? 'fr' : 'en';
                    document.documentElement.dir = selectedLang === 'ar' ? 'rtl' : 'ltr';

                    if (typeof setLanguage === 'function') {
                        setLanguage(selectedLang);
                    }
                    if (typeof updatePageTranslations === 'function') {
                        updatePageTranslations();
                    }
                    // Update placeholders
                    updatePlaceholders();
                    // Refresh dynamic dropdowns with new translations
                    refreshDynamicDropdowns();
                    // Refresh report display
                    displayReports();
                    // Update date display
                    updateDateDisplay();
                });
            }

            // Initialize translations
            try {
                if (typeof updatePageTranslations === 'function') {
                    updatePageTranslations();
                    console.log(' Translations updated');
                }
            } catch (error) {
                console.warn(' Translation update failed:', error);
            }

            // Update placeholders on load
            try {
                updatePlaceholders();
                console.log(' Placeholders updated');
            } catch (error) {
                console.warn(' Placeholder update failed:', error);
            }

            // Load initial data with error isolation
            try {
                console.log(' Starting loadInitialData...');
                await loadInitialData();
                console.log(' Initial data loaded');
            } catch (error) {
                console.error(' loadInitialData failed:', error);
            }

            // Setup event listeners with error isolation
            try {
                console.log(' Setting up event listeners...');
                setupEventListeners();
                console.log(' Event listeners setup');
            } catch (error) {
                console.error(' setupEventListeners failed:', error);
            }

            // Load user data and setup page hero
            try {
                loadUserData();
                updateDateDisplay();
            } catch (error) {
                console.error(' User data loading failed:', error);
            }

            // Initialize notification system
            try {
                setTimeout(() => {
                    loadNotifications();
                    startNotificationRefresh();
                }, 1000);
            } catch (error) {
                console.error(' Notification system initialization failed:', error);
            }

            // Load employees and responsibles with error isolation
            try {
                console.log(' Loading employees and responsibles...');
                await loadAllEmployeesAndResponsibles();
                console.log(' Employees and responsibles loaded');
            } catch (error) {
                console.error(' loadAllEmployeesAndResponsibles failed:', error);
            }

            // Load reports with error isolation
            try {
                console.log(' Loading reports...');
                loadReports();
                console.log(' Reports loading initiated');
            } catch (error) {
                console.error(' loadReports failed:', error);
            }

            console.log(' Initialization sequence completed');
        });

        // Charger les donnes initiales
        async function loadInitialData() {
            try {
                console.log(' Starting loadInitialData...');

                // Check if we're in an iframe
                const isInIframe = window.self !== window.top;
                console.log(' Running in iframe:', isInIframe);

                // Rcuprer les paramtres depuis l'URL
                const urlParams = new URLSearchParams(window.location.search);
                const userId = urlParams.get('user_id');
                const employeeId = urlParams.get('employee_id');
                const username = urlParams.get('username');
                const firstName = urlParams.get('first');
                const lastName = urlParams.get('last');
                const role = urlParams.get('role');

                console.log(' URL params:', { userId, employeeId, username, firstName, lastName, role });

                // Crer l'objet utilisateur avec les paramtres de l'URL
                currentUser = {
                    id: userId || employeeId || 'director-1',
                    employee_id: employeeId,
                    user_id: userId,
                    username: username,
                    first_name: firstName || 'Directeur',
                    last_name: lastName || 'Gnral',
                    department: 'Direction Gnrale',
                    role: role || 'Director'
                };

                // Ensure we keep a valid UUID when available (including stored user info)
                try {
                    const storedUser = JSON.parse(localStorage.getItem('user') || 'null');
                    const uuidCandidate = [userId, employeeId, storedUser?.id, storedUser?.user_id, storedUser?.employee_id]
                        .find(v => UUID_REGEX.test(v || ''));
                    if (uuidCandidate) {
                        currentUser.id = uuidCandidate;
                    }
                } catch (e) {
                    console.warn(' Unable to parse stored user for UUID fallback:', e.message);
                }

                console.log(' Current user created:', currentUser);

                // Afficher le directeur
                const currentUserEl = document.getElementById('currentUser');
                if (currentUserEl) {
                    currentUserEl.textContent = `${currentUser.first_name} ${currentUser.last_name}`;
                }

                // Update hero section
                const heroUser = document.getElementById('heroUser');
                if (heroUser) {
                    heroUser.textContent = `${currentUser.first_name} ${currentUser.last_name}`;
                }

                const heroDate = document.getElementById('heroDate');
                if (heroDate) {
                    const today = new Date();
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    heroDate.textContent = today.toLocaleDateString('en-US', options);
                }

                console.log(' UI elements updated');

                // Charger les dpartements (with error isolation)
                try {
                    console.log(' Loading departments...');
                    await loadDepartments();
                    console.log(' Departments loaded successfully');
                } catch (deptError) {
                    console.error(' Department loading failed, but continuing:', deptError);
                    // Don't let department loading failure break the entire initialization
                }

                console.log(' loadInitialData completed');
            } catch (error) {
                console.error(' Critical error in loadInitialData:', error);
                // Ensure we don't break the iframe or parent window
                try {
                    showNotification('Erreur d\'initialisation. Fonctionnalits limites.', 'error');
                } catch (notifError) {
                    console.error(' Could not show notification:', notifError);
                }
            }
        }

        // Charger les dpartements
        async function loadDepartments() {
            try {
                const url = `${API}/api/rapportemp/director/departments?t=${Date.now()}&cache=${Math.random()}`;
                console.log(' Loading departments from:', url);
                console.log(' Auth headers:', getAuthHeaders());
                console.log(' Current hostname:', window.location.hostname);
                console.log(' Current origin:', window.location.origin);

                const fetchOptions = {
                    method: 'GET',
                    headers: {
                        ...getAuthHeaders(),
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    },
                    cache: 'no-store'
                };

                console.log(' Fetch options:', fetchOptions);

                let response;
                try {
                    response = await fetch(url, fetchOptions);
                } catch (networkError) {
                    console.error(' Network error during fetch:', networkError);

                    // Check if this is a CORS/origin issue
                    const currentOrigin = window.location.origin;
                    const isFileProtocol = window.location.protocol === 'file:';
                    const isWrongOrigin = !currentOrigin.includes('localhost:3020') && !currentOrigin.includes('127.0.0.1:3020');

                    if (isFileProtocol || isWrongOrigin) {
                        console.warn(' CORS/Origin Issue Detected - continuing with limited functionality');
                        console.warn(' Current page origin:', currentOrigin);
                        console.warn(' API target:', url);
                        console.warn(' Recommended: Access this page at http://localhost:3020/reportdir.html');

                        // Show user-friendly warning message (not error)
                        const warningDiv = document.createElement('div');
                        warningDiv.style.cssText = `
                            position: fixed;
                            top: 20px;
                            left: 50%;
                            transform: translateX(-50%);
                            background: linear-gradient(135deg, #f59e0b, #d97706);
                            color: white;
                            padding: 16px 24px;
                            border-radius: 12px;
                            box-shadow: 0 10px 40px rgba(245, 158, 11, 0.3);
                            z-index: 10000;
                            max-width: 500px;
                            font-family: 'Outfit', sans-serif;
                            font-size: 13px;
                        `;
                        warningDiv.innerHTML = `
                            <div style="display: flex; align-items: start; gap: 12px;">
                                <i class="fas fa-info-circle" style="font-size: 20px; margin-top: 1px;"></i>
                                <div>
                                    <p style="margin: 0; font-weight: 600; line-height: 1.4;">
                                        For best results, access at: <code style="background: rgba(0,0,0,0.2); padding: 2px 6px; border-radius: 4px;">http://localhost:3020/reportdir.html</code>
                                    </p>
                                </div>
                                <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; cursor: pointer; font-size: 18px; padding: 0; margin-left: auto;"></button>
                            </div>
                        `;
                        document.body.appendChild(warningDiv);

                        // Auto-hide after 8 seconds
                        setTimeout(() => {
                            if (warningDiv.parentElement) {
                                warningDiv.remove();
                            }
                        }, 8000);

                        // Don't throw error - just continue with empty departments
                        console.warn(' Continuing without departments data');
                        return; // Exit function early without throwing
                    }

                    // Try with a simpler request (no auth, minimal headers)
                    console.log(' Retrying with minimal headers...');
                    try {
                        const simpleOptions = {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        };
                        response = await fetch(url, simpleOptions);
                        console.log(' Simple request succeeded');
                    } catch (simpleError) {
                        console.error(' Simple request also failed:', simpleError);
                        throw new Error(`Network error: ${networkError.message}. Simple retry also failed: ${simpleError.message}`);
                    }
                }
                console.log(' Response status:', response.status);
                console.log(' Response headers:', [...response.headers.entries()]);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(' Response error:', errorText);

                    // If authentication failed (401/403), try without auth
                    if (response.status === 401 || response.status === 403) {
                        console.log(' Authentication failed, trying without auth headers...');
                        const noAuthOptions = {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Cache-Control': 'no-cache',
                                'Pragma': 'no-cache'
                            },
                            cache: 'no-store'
                        };

                        const noAuthResponse = await fetch(url, noAuthOptions);
                        console.log(' No-auth response status:', noAuthResponse.status);

                        if (noAuthResponse.ok) {
                            const noAuthData = await noAuthResponse.json();
                            console.log(' Success with no-auth request:', noAuthData);

                            if (noAuthData.success) {
                                departments = noAuthData.departments;
                                // Continue with the same logic as authenticated request
                                const departmentSelects = [
                                    'departmentFilter',
                                    'employeeDeptFilter',
                                    'responsibleDeptFilter'
                                ];

                                departmentSelects.forEach(selectId => {
                                    const select = document.getElementById(selectId);
                                    if (select) {
                                        const allDeptText = typeof translate === 'function' ? translate('report.all_departments') : 'Tous les dpartements';
                                        const employeesText = typeof translate === 'function' ? translate('report.employees_count') : 'employs';
                                        select.innerHTML = `<option value="all">${allDeptText}</option>`;
                                        departments.forEach(dept => {
                                            const option = new Option(`${dept.name} (${dept.employee_count} ${employeesText})`, dept.id);
                                            select.add(option);
                                        });
                                    }
                                });
                                return; // Success, exit function
                            }
                        }
                    }

                    throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                }

                const data = await response.json();
                console.log(' Departments data:', data);

                if (data.success) {
                    departments = data.departments;

                    // Remplir tous les selecteurs de dpartements
                    const departmentSelects = [
                        'departmentFilter',
                        'employeeDeptFilter',
                        'responsibleDeptFilter'
                    ];

                    departmentSelects.forEach(selectId => {
                        const select = document.getElementById(selectId);
                        if (select) {
                            const allDeptText = typeof translate === 'function' ? translate('report.all_departments') : 'Tous les dpartements';
                            const employeesText = typeof translate === 'function' ? translate('report.employees_count') : 'employs';
                            select.innerHTML = `<option value="all">${allDeptText}</option>`;
                            departments.forEach(dept => {
                                const option = new Option(`${dept.name} (${dept.employee_count} ${employeesText})`, dept.id);
                                select.add(option);
                            });
                        }
                    });
                }
            } catch (error) {
                console.error(' Erreur chargement dpartements (attempt 1):', error);

                // Fallback: try with localhost if 127.0.0.1 failed, or vice versa
                try {
                    const fallbackHost = API.includes('127.0.0.1') ? 'localhost' : '127.0.0.1';
                    const fallbackUrl = `http://${fallbackHost}:3020/api/rapportemp/director/departments?fallback=true&t=${Date.now()}`;
                    console.log(' Trying fallback URL:', fallbackUrl);

                    const fallbackResponse = await fetch(fallbackUrl, {
                        method: 'GET',
                        headers: getAuthHeaders(),
                        cache: 'no-store'
                    });

                    if (fallbackResponse.ok) {
                        const fallbackData = await fallbackResponse.json();
                        console.log(' Fallback successful:', fallbackData);

                        if (fallbackData.success) {
                            departments = fallbackData.departments;
                            // Update selectors with fallback data
                            const departmentSelects = ['departmentFilter', 'employeeDeptFilter', 'responsibleDeptFilter'];
                            departmentSelects.forEach(selectId => {
                                const select = document.getElementById(selectId);
                                if (select) {
                                    select.innerHTML = '<option value="all">Tous les dpartements</option>';
                                    departments.forEach(dept => {
                                        const option = new Option(`${dept.name} (${dept.employee_count} employs)`, dept.id);
                                        select.add(option);
                                    });
                                }
                            });
                            return; // Success with fallback
                        }
                    }
                } catch (fallbackError) {
                    console.error(' Fallback also failed:', fallbackError);
                }

                // If both attempts failed, initialize with empty departments and continue
                console.error(' All attempts failed. Original error:', error);
                console.warn(' Continuing with empty departments list. Services may be unavailable.');

                // Initialize empty departments to prevent further errors
                departments = [];

                // Still populate selectors with default options
                const departmentSelects = ['departmentFilter', 'employeeDeptFilter', 'responsibleDeptFilter'];
                departmentSelects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        select.innerHTML = '<option value="all">Tous les dpartements (Services indisponibles)</option>';
                    }
                });

                // Show non-blocking notification instead of alert
                showNotification('Services backend indisponibles. Fonctionnalits limites.', 'warning');
            }
        }

        // Charger tous les employs et responsables au dmarrage
        async function loadAllEmployeesAndResponsibles() {
            try {
                console.log(' Chargement des employs et responsables...');

                // Initialize with empty arrays to prevent errors
                employees = employees || [];
                responsibles = responsibles || [];

                // Try to load employees with multiple endpoint fallbacks
                try {
                    let employeesResponse;
                    const authHeaders = getAuthHeaders();

                    // Try main employees endpoint first
                    try {
                        employeesResponse = await fetch(`${API}/employees`, {
                            headers: authHeaders,
                            timeout: 5000
                        });
                    } catch (e) {
                        console.warn('Primary employees endpoint failed, trying fallback...');
                        // Fallback to user management service
                        employeesResponse = await fetch(`${API}/api/users/employees`, {
                            headers: authHeaders,
                            timeout: 5000
                        });
                    }

                    if (employeesResponse && employeesResponse.ok) {
                        const employeesData = await employeesResponse.json();
                        employees = Array.isArray(employeesData) ? employeesData : (employeesData.employees || []);
                        console.log(' Employs chargs:', employees.length);
                    } else {
                        console.warn(' Erreur chargement employs:', employeesResponse?.status || 'Network error');
                        employees = []; // Fallback to empty array
                    }
                } catch (error) {
                    console.warn(' Erreur rseau employs:', error.message);
                    employees = []; // Fallback to empty array
                }

                // Try to load responsibles with error handling
                try {
                    console.log(' Chargement des responsables...');
                    const responsiblesResponse = await fetch(`${API}/api/rapportemp/responsibles`, {
                        headers: getAuthHeaders(),
                        timeout: 5000
                    });
                    console.log(' Rponse responsables:', responsiblesResponse.status);

                    if (responsiblesResponse.ok) {
                        const responsiblesData = await responsiblesResponse.json();
                        console.log(' Donnes responsibles:', responsiblesData);

                        if (responsiblesData.success && responsiblesData.responsibles) {
                            responsibles = responsiblesData.responsibles;
                            console.log(' Responsables chargs:', responsibles.length);
                        } else {
                            console.warn(' Erreur dans la rponse responsibles:', responsiblesData.error || 'Invalid response format');
                            responsibles = []; // Fallback to empty array
                        }
                    } else {
                        console.warn(' Erreur HTTP chargement responsibles:', responsiblesResponse.status);
                        try {
                            const errorText = await responsiblesResponse.text();
                            console.warn(' Dtails erreur:', errorText);
                        } catch (e) {
                            console.warn(' Could not read error response');
                        }
                        responsibles = []; // Fallback to empty array
                    }
                } catch (error) {
                    console.warn(' Erreur rseau responsables:', error.message);
                    responsibles = []; // Fallback to empty array
                }

                // Always initialize selectors, even with empty arrays
                populateAllEmployeesAndResponsibles();

                console.log(' Initialisation termine - Employs:', employees.length, 'Responsables:', responsibles.length);
            } catch (error) {
                console.error(' Erreur critique chargement employs et responsables:', error);
                // Ensure arrays are initialized even on critical error
                employees = employees || [];
                responsibles = responsibles || [];
                populateAllEmployeesAndResponsibles();
            }
        }

        // Remplir les selecteurs avec tous les employs et responsables
        function populateAllEmployeesAndResponsibles() {
            try {
                // Ensure arrays are initialized
                const safeEmployees = Array.isArray(employees) ? employees : [];
                const safeResponsibles = Array.isArray(responsibles) ? responsibles : [];

                // Remplir tous les selecteurs d'employs
                const employeeSelects = ['employeeFilter', 'employeeOnlyFilter'];
                employeeSelects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        const allEmpText = typeof translate === 'function' ? translate('report.all_employees') : 'Tous les employs';
                        select.innerHTML = `<option value="all">${allEmpText}</option>`;

                        safeEmployees.forEach(emp => {
                            if (emp && emp.first_name && emp.last_name && emp.id) {
                                const option = new Option(`${emp.first_name} ${emp.last_name}`, emp.id);
                                select.add(option);
                            }
                        });

                        console.log(` Populated ${selectId} with ${safeEmployees.length} employees`);
                    }
                });

                // Remplir tous les selecteurs de responsables
                const responsibleSelects = ['responsibleFilter', 'responsibleOnlyFilter'];
                responsibleSelects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        const allRespText = typeof translate === 'function' ? translate('report.all_responsibles') : 'Tous les responsables';
                        const deptText = typeof translate === 'function' ? translate('report.department') : 'Dpartement';
                        select.innerHTML = `<option value="all">${allRespText}</option>`;

                        safeResponsibles.forEach(resp => {
                            if (resp && resp.first_name && resp.last_name && resp.id) {
                                const displayName = `${resp.first_name} ${resp.last_name} (${resp.department_name || deptText})`;
                                const option = new Option(displayName, resp.id);
                                select.add(option);
                            }
                        });

                        console.log(` Populated ${selectId} with ${safeResponsibles.length} responsibles`);
                    }
                });
            } catch (error) {
                console.error(' Error populating selectors:', error);
                // Ensure selectors have at least the default option
                const allSelects = ['employeeFilter', 'employeeOnlyFilter', 'responsibleFilter', 'responsibleOnlyFilter'];
                allSelects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select && select.options.length === 0) {
                        const defaultText = selectId.includes('employee') ? 'Tous les employs' : 'Tous les responsables';
                        select.innerHTML = `<option value="all">${defaultText}</option>`;
                    }
                });
            }
        }

        // Charger les donnes du dpartement slectionn (pour "Tous les rapports")
        async function loadDepartmentData() {
            const departmentId = document.getElementById('departmentFilter').value;
            const employeeSelect = document.getElementById('employeeFilter');
            const responsibleSelect = document.getElementById('responsibleFilter');

            // Rinitialiser les filtres
            currentFilters.department_id = departmentId;
            currentFilters.employee_id = 'all';
            currentFilters.responsible_id = 'all';

            if (departmentId === 'all') {
                // Afficher tous les employs et responsables
                populateAllEmployeesAndResponsibles();
            } else {
                try {
                    // Charger les employs du dpartement
                    const employeesResponse = await fetch(`${API}/api/rapportemp/director/employees-by-department/${departmentId}?type=employee`, { headers: getAuthHeaders() });
                    const employeesData = await employeesResponse.json();

                    if (employeesData.success) {
                        departmentEmployees.set(departmentId, employeesData.employees);
                        employeeSelect.innerHTML = '<option value="all">Tous les employs</option>';
                        employeesData.employees.forEach(emp => {
                            const option = new Option(`${emp.first_name} ${emp.last_name}`, emp.id);
                            employeeSelect.add(option);
                        });
                    }

                    // Charger les responsables du dpartement
                    const responsiblesResponse = await fetch(`${API}/api/rapportemp/director/employees-by-department/${departmentId}?type=responsible`, { headers: getAuthHeaders() });
                    const responsiblesData = await responsiblesResponse.json();

                    if (responsiblesData.success) {
                        departmentResponsibles.set(departmentId, responsiblesData.employees);
                        responsibleSelect.innerHTML = '<option value="all">Tous les responsables</option>';
                        responsiblesData.employees.forEach(resp => {
                            const option = new Option(`${resp.first_name} ${resp.last_name}`, resp.id);
                            responsibleSelect.add(option);
                        });
                    }
                } catch (error) {
                    console.error('Erreur chargement donnes dpartement:', error);
                }
            }

            // Appliquer les filtres automatiquement
            applyFilters();
        }

        // Charger les employs par dpartement (pour "Rapports Employs")
        async function loadEmployeeDepartmentData() {
            const departmentId = document.getElementById('employeeDeptFilter').value;
            const employeeSelect = document.getElementById('employeeOnlyFilter');

            // Rinitialiser les filtres
            currentFilters.department_id = departmentId;
            currentFilters.employee_id = 'all';

            if (departmentId === 'all') {
                // Afficher tous les employs
                employeeSelect.innerHTML = '<option value="all">Tous les employs</option>';
                employees.forEach(emp => {
                    const option = new Option(`${emp.first_name} ${emp.last_name}`, emp.id);
                    employeeSelect.add(option);
                });
            } else {
                try {
                    // Charger les employs du dpartement
                    const employeesResponse = await fetch(`${API}/api/rapportemp/director/employees-by-department/${departmentId}?type=employee`, { headers: getAuthHeaders() });
                    const employeesData = await employeesResponse.json();

                    if (employeesData.success) {
                        employeeSelect.innerHTML = '<option value="all">Tous les employs</option>';
                        employeesData.employees.forEach(emp => {
                            const option = new Option(`${emp.first_name} ${emp.last_name}`, emp.id);
                            employeeSelect.add(option);
                        });
                    }
                } catch (error) {
                    console.error('Erreur chargement employs dpartement:', error);
                }
            }

            // Appliquer les filtres automatiquement
            applyFilters();
        }

        // Charger les responsables par dpartement (pour "Rapports Responsables")
        async function loadResponsibleDepartmentData() {
            const departmentId = document.getElementById('responsibleDeptFilter').value;
            const responsibleSelect = document.getElementById('responsibleOnlyFilter');

            // Rinitialiser les filtres
            currentFilters.department_id = departmentId;
            currentFilters.responsible_id = 'all';

            if (departmentId === 'all') {
                // Afficher tous les responsables
                responsibleSelect.innerHTML = '<option value="all">Tous les responsables</option>';
                responsibles.forEach(resp => {
                    const option = new Option(`${resp.first_name} ${resp.last_name} (${resp.department_name || 'Dpartement'})`, resp.id);
                    responsibleSelect.add(option);
                });
            } else {
                try {
                    // Charger les responsables du dpartement
                    const responsiblesResponse = await fetch(`${API}/api/rapportemp/director/employees-by-department/${departmentId}?type=responsible`, { headers: getAuthHeaders() });
                    const responsiblesData = await responsiblesResponse.json();

                    if (responsiblesData.success) {
                        responsibleSelect.innerHTML = '<option value="all">Tous les responsables</option>';
                        responsiblesData.employees.forEach(resp => {
                            const option = new Option(`${resp.first_name} ${resp.last_name}`, resp.id);
                            responsibleSelect.add(option);
                        });
                    }
                } catch (error) {
                    console.error('Erreur chargement responsables dpartement:', error);
                }
            }

            // Appliquer les filtres automatiquement
            applyFilters();
        }

        // Slectionner un filtre (status ou period)
        function selectFilter(type, value) {
            // Mettre  jour l'interface
            document.querySelectorAll(`.filter-button[data-${type}]`).forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-${type}="${value}"]`).classList.add('active');

            // Mettre  jour les filtres
            currentFilters[type] = value;

            // Appliquer les filtres automatiquement
            applyFilters();
        }

        // Effacer tous les filtres
        function clearAllFilters() {
            // Rinitialiser tous les slecteurs
            const allSelects = [
                'departmentFilter', 'employeeFilter', 'responsibleFilter',
                'employeeDeptFilter', 'employeeOnlyFilter',
                'responsibleDeptFilter', 'responsibleOnlyFilter'
            ];

            allSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.value = 'all';
                }
            });

            // Rinitialiser les boutons de statut et priode
            document.querySelectorAll('.filter-button[data-status]').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.filter-button[data-status="all"]').classList.add('active');

            document.querySelectorAll('.filter-button[data-period]').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.filter-button[data-period="all"]').classList.add('active');

            // Rinitialiser le type de rapport
            document.querySelectorAll('.report-type-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('.report-type-tab[data-type="all"]').classList.add('active');

            // Afficher les filtres pour "Tous les rapports"
            selectReportType('all');

            // Rinitialiser les filtres
            currentFilters = {
                type: 'all',
                department_id: 'all',
                employee_id: 'all',
                responsible_id: 'all',
                status: 'all',
                period: 'all'
            };

            // Remplir  nouveau tous les employs et responsables
            populateAllEmployeesAndResponsibles();

            // Recharger les rapports
            loadReports();
        }

        // Slectionner le type de rapport
        function selectReportType(type) {
            // Mettre  jour l'interface
            document.querySelectorAll('.report-type-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');

            // Afficher/masquer les filtres appropris
            const allReportsFilters = document.getElementById('allReportsFilters');
            const employeeReportsFilters = document.getElementById('employeeReportsFilters');
            const responsibleReportsFilters = document.getElementById('responsibleReportsFilters');

            // Masquer tous les filtres
            allReportsFilters.style.display = 'none';
            employeeReportsFilters.style.display = 'none';
            responsibleReportsFilters.style.display = 'none';

            // Afficher les filtres appropris
            if (type === 'all') {
                allReportsFilters.style.display = 'grid';
                // Rinitialiser les filtres pour "Tous les rapports"
                currentFilters.employee_id = 'all';
                currentFilters.responsible_id = 'all';
            } else if (type === 'employee') {
                employeeReportsFilters.style.display = 'grid';
                // Rinitialiser les filtres pour "Rapports Employs"
                currentFilters.responsible_id = 'all';
                currentFilters.employee_id = 'all';
            } else if (type === 'responsible') {
                responsibleReportsFilters.style.display = 'grid';
                // Rinitialiser les filtres pour "Rapports Responsables"
                currentFilters.employee_id = 'all';
                currentFilters.responsible_id = 'all';
            }

            currentFilters.type = type;

            // Appliquer les filtres automatiquement
            applyFilters();
        }

        // Configuration des vnements
        function setupEventListeners() {
            document.getElementById('acknowledgeAllBtn').addEventListener('click', acknowledgeAllPendingReports);
            // Recherche texte: filtrage ct client
            const searchEl = document.getElementById('textSearch');
            if (searchEl) {
                searchEl.addEventListener('input', () => {
                    displayReports();
                });
            }
            const prioBtn = document.getElementById('openPriorities');
            if (prioBtn) {
                prioBtn.addEventListener('click', () => {
                    const params = new URLSearchParams(window.location.search);
                    window.location.href = `priorities.html?${params.toString()}`;
                });
            }
        }

        // Charger les rapports
        async function loadReports() {
            try {
                showLoading(true);

                // Construire les paramtres de filtrage
                const params = new URLSearchParams();

                // Filtre par type
                if (currentFilters.type && currentFilters.type !== 'all') {
                    params.append('type', currentFilters.type);
                }

                // Filtre par dpartement
                if (currentFilters.department_id && currentFilters.department_id !== 'all') {
                    params.append('department_id', currentFilters.department_id);
                }

                // Filtre par employ spcifique
                if (currentFilters.employee_id && currentFilters.employee_id !== 'all') {
                    params.append('employee_id', currentFilters.employee_id);
                }

                // Filtre par responsable spcifique
                if (currentFilters.responsible_id && currentFilters.responsible_id !== 'all') {
                    params.append('responsible_id', currentFilters.responsible_id);
                }

                // Filtre par statut
                if (currentFilters.status && currentFilters.status !== 'all') {
                    params.append('status', currentFilters.status);
                }

                // Filtre par priode
                if (currentFilters.period && currentFilters.period !== 'all') {
                    params.append('period', currentFilters.period);
                }

                console.log('Paramtres de filtrage:', params.toString());

                const response = await fetch(`${API}/api/rapportemp/director/all-reports?${params}`, { headers: getAuthHeaders() });
                const data = await response.json();

                if (data.success) {
                    reports = data.reports || [];
                    console.log('Rapports chargs:', reports.length);
                    updateStatistics();
                    displayReports();
                } else {
                    console.error('Erreur chargement rapports:', data.error);
                    showNoReports();
                }
            } catch (error) {
                console.error('Erreur chargement rapports:', error);
                showNoReports();
            } finally {
                showLoading(false);
            }
        }

        // Mettre  jour les statistiques
        async function updateStatistics() {
            try {
                const response = await fetch(`${API}/api/rapportemp/director/stats`, { headers: getAuthHeaders() });
                const data = await response.json();

                if (data.success) {
                    document.getElementById('totalReports').textContent = data.stats.total_reports || 0;
                    document.getElementById('pendingReports').textContent = data.stats.pending || 0;
                    document.getElementById('acknowledgedReports').textContent = data.stats.acknowledged || 0;
                    document.getElementById('todayReports').textContent = data.stats.today || 0;

                    // Update tab badges
                    const reportsTabBadge = document.getElementById('reportsTabBadge');
                    const prioritiesTabBadge = document.getElementById('prioritiesTabBadge');
                    if (reportsTabBadge) {
                        reportsTabBadge.textContent = data.stats.total_reports || 0;
                    }
                    if (prioritiesTabBadge) {
                        prioritiesTabBadge.textContent = data.stats.pending || 0;
                    }
                }
            } catch (error) {
                console.error('Erreur chargement statistiques:', error);
            }
        }

        // Afficher les rapports (cartes lisibles et denses, alignes avec le thme directeur)
        function displayReports() {
            const filteredReports = getFilteredReports();
            const reportsList = document.getElementById('reportsList');
            const reportsCount = document.getElementById('reportsCount');

            // Update global reports variable for new view system
            allReports = filteredReports;
            reportsCount.textContent = filteredReports.length;

            // Use new rendering system
            renderReportsList();
        }

        // Update pagination controls
        function updatePaginationControls(page, totalPages, totalItems) {
            const startItem = ((page - 1) * itemsPerPage) + 1;
            const endItem = Math.min(page * itemsPerPage, totalItems);

            document.getElementById('paginationInfo').textContent = `Showing ${startItem}-${endItem} of ${totalItems}`;
            document.getElementById('prevPageBtn').disabled = page === 1;
            document.getElementById('nextPageBtn').disabled = page === totalPages;
            document.getElementById('currentPageNum').textContent = `Page ${page} of ${totalPages}`;
        }

        // Go to previous page
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                displayReports();
                scrollToReportsList();
            }
        }

        // Go to next page
        function nextPage() {
            const filteredReports = getFilteredReports();
            const totalPages = Math.ceil(filteredReports.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayReports();
                scrollToReportsList();
            }
        }

        // Scroll to top of reports list
        function scrollToReportsList() {
            const reportsList = document.getElementById('reportsList');
            if (reportsList) {
                reportsList.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Reset to first page when filters change
        function resetPagination() {
            currentPage = 1;
        }

        // Download report PDF
        async function downloadReportPDF(reportId, pdfPath) {
            try {
                // If pdfPath is a full URL or absolute path, use it directly
                if (pdfPath && (pdfPath.startsWith('http') || pdfPath.startsWith('/'))) {
                    window.open(pdfPath, '_blank');
                    return;
                }

                // Just open the PDF URL directly in a new tab - let the browser handle it
                const pdfUrl = `${API}/api/rapportemp/${reportId}/pdf`;
                console.log('Opening PDF URL:', pdfUrl);
                window.open(pdfUrl, '_blank');

            } catch (error) {
                console.error('Error downloading PDF:', error);
                alert(`Unable to download PDF.\n\nMake sure the backend server is running on port 3020.\n\nTo start the server, run:\n./start-services.sh\n\nThen try again.`);
            }
        }

        // Charger les accuss de rception pour un rapport
        async function loadAcknowledgements(reportId) {
            try {
                const response = await fetch(`${API}/api/rapportemp/${reportId}/acknowledgements`, { headers: getAuthHeaders() });
                if (!response.ok) {
                    throw new Error('Erreur lors du chargement des accuss');
                }
                const data = await response.json();
                return data.success ? data : { acknowledgements: [], total: 0, acknowledged: 0 };
            } catch (error) {
                console.error('Erreur lors du chargement des accuss:', error);
                return { acknowledgements: [], total: 0, acknowledged: 0 };
            }
        }

        // Voir les dtails d'un rapport
        async function viewReportDetails(reportId) {
            try {
                const response = await fetch(`${API}/api/rapportemp/${reportId}`, { headers: getAuthHeaders() });
                const data = await response.json();

                if (data.success) {
                    const report = data.report;

                    // Charger les informations des accuss de rception
                    const acknowledgementsData = await loadAcknowledgements(reportId);
                    const acknowledgements = acknowledgementsData.acknowledgements || [];
                    const acknowledgedCount = acknowledgementsData.acknowledged || 0;
                    const totalRecipients = acknowledgementsData.total || 0;

                    const modalContent = document.getElementById('modalContent');
                    const formattedCreatedDate = formatDate(report.created_at);

                    // Get translations
                    // Get translations with fallbacks
                    const subjectLabel = typeof translate === 'function' ? translate('report.subject_text') : 'Sujet';
                    const idLabel = typeof translate === 'function' ? translate('report.identifier') : 'Identifiant';
                    const acknowledgementsLabel = typeof translate === 'function' ? translate('report.acknowledgements') : 'Accuss de rception';
                    const acknowledgedText = typeof translate === 'function' ? translate('report.acknowledged_badge') : 'Accus';
                    const waitingText = typeof translate === 'function' ? translate('report.waiting') : 'En attente';
                    const noRecipientsText = typeof translate === 'function' ? translate('report.no_recipients') : 'Aucun destinataire spcifi';
                    const notSpecifiedText = typeof translate === 'function' ? translate('report.not_specified') : 'Non spcifi';
                    const haveAcknowledgedText = typeof translate === 'function' ? translate('report.have_acknowledged') : 'ont accus rception';
                    const employeeLabel = typeof translate === 'function' ? translate('report.employee') : 'Employ';
                    const departmentLabel = typeof translate === 'function' ? translate('report.department_label') : 'Dpartement';
                    const dateLabel = typeof translate === 'function' ? translate('report.created') : 'Date';
                    const pdfLabel = typeof translate === 'function' ? translate('report.pdf_document') : 'PDF';
                    const availableText = typeof translate === 'function' ? translate('report.available') : 'Disponible';
                    const downloadText = typeof translate === 'function' ? translate('report.download') : 'Tlcharger';
                    const viewText = typeof translate === 'function' ? translate('report.view') : 'Voir';
                    const acknowledgedStatusText = typeof translate === 'function' ? translate('report.acknowledged') : 'Accus';

                    modalContent.innerHTML = `
                        <!-- Report Header Card -->
                        <div class="report-detail-card">
                            <div class="report-detail-header">
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <div>
                                            <h2 class="text-xl font-bold text-gray-900 mb-1">${report.title || 'Rapport'}</h2>
                                            <div class="flex items-center gap-4 text-sm text-gray-600">
                                                <span class="flex items-center gap-1">
                                                    <i class="fas fa-user text-gray-400"></i>
                                                    ${employeeLabel}: ${report.first_name} ${report.last_name}
                                                </span>
                                                <span class="flex items-center gap-1">
                                                    <i class="fas fa-building text-gray-400"></i>
                                                    ${departmentLabel}: ${report.department_name || notSpecifiedText}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end gap-2">
                                    <span class="px-3 py-1 text-sm font-semibold rounded-full ${getStatusClass(report.status)}">
                                        ${getStatusText(report.status)}
                                    </span>
                                    <span class="inline-flex items-center gap-1 px-3 py-1 text-sm rounded-full bg-slate-50 text-slate-600 border border-slate-200">
                                        <i class="fas fa-calendar"></i>
                                        ${dateLabel}: ${formattedCreatedDate}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Report Information Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${report.subject ? `
                                <div class="report-info-card">
                                    <div class="report-info-icon">
                                        <i class="fas fa-envelope"></i>
                                    </div>
                                    <div class="report-info-content">
                                        <p class="report-info-label">${subjectLabel}</p>
                                        <p class="report-info-value">${report.subject}</p>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="report-info-card">
                                <div class="report-info-icon">
                                    <i class="fas fa-hashtag"></i>
                                </div>
                                <div class="report-info-content">
                                    <p class="report-info-label">${idLabel}</p>
                                    <p class="report-info-value break-all">${report.id}</p>
                                </div>
                            </div>

                            ${report.pdf_path || report.pdf_url ? `
                                <div class="report-info-card">
                                    <div class="report-info-icon">
                                        <i class="fas fa-file-pdf"></i>
                                    </div>
                                    <div class="report-info-content">
                                        <p class="report-info-label">${pdfLabel}</p>
                                        <button onclick="downloadReportPDF('${report.id}', '${report.pdf_path || report.pdf_url}')" class="report-info-action">
                                            <i class="fas fa-download mr-1"></i>
                                            ${downloadText}
                                        </button>
                                    </div>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Acknowledgements Section -->
                        <div class="report-detail-card">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-white">
                                        <i class="fas fa-check-double text-sm"></i>
                                    </div>
                                    <h3 class="text-lg font-semibold text-gray-900">${acknowledgementsLabel}</h3>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="acknowledgement-badge">
                                        ${acknowledgedCount}/${totalRecipients} ${haveAcknowledgedText}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="acknowledgements-list">
                                ${acknowledgements.length > 0 ? `
                                    <div class="space-y-2">
                                        ${acknowledgements.map(ack => `
                                            <div class="acknowledgement-item">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-gradient-to-br ${ack.acknowledged ? 'from-green-500 to-green-600' : 'from-yellow-500 to-yellow-600'} flex items-center justify-center text-white flex-shrink-0">
                                                        <i class="fas fa-user text-sm"></i>
                                                    </div>
                                                    <div class="flex-1 min-w-0">
                                                        <div class="flex items-center justify-between">
                                                            <div>
                                                                <p class="font-medium text-gray-900">${ack.first_name} ${ack.last_name}</p>
                                                                ${ack.department_name ? `<p class="text-sm text-gray-500">${ack.department_name}</p>` : ''}
                                                            </div>
                                                            <div class="text-right">
                                                                ${ack.acknowledged ? `
                                                                    <span class="acknowledgement-status acknowledged">
                                                                        <i class="fas fa-check-circle mr-1"></i>
                                                                        ${acknowledgedText}
                                                                    </span>
                                                                    <p class="text-xs text-gray-400 mt-1">${formatDateTime(ack.acknowledged_at)}</p>
                                                                ` : `
                                                                    <span class="acknowledgement-status waiting">
                                                                        <i class="fas fa-clock mr-1"></i>
                                                                        ${waitingText}
                                                                    </span>
                                                                `}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : `
                                    <div class="text-center py-8">
                                        <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3">
                                            <i class="fas fa-users text-gray-400 text-xl"></i>
                                        </div>
                                        <p class="text-gray-500">${noRecipientsText}</p>
                                    </div>
                                `}
                            </div>
                        </div>
                        </div>
                    `;

                    // Grer le bouton d'accus de rception dans le modal
                    const modalAckBtn = document.getElementById('modalAcknowledgeBtn');
                    if (report.status === 'pending') {
                        modalAckBtn.classList.remove('hidden');
                        modalAckBtn.onclick = () => {
                            acknowledgeReport(reportId);
                            closeReportDetails();
                        };
                    } else {
                        modalAckBtn.classList.add('hidden');
                    }

                    document.getElementById('reportDetailsModal').classList.remove('hidden');
                    document.body.classList.add('overflow-hidden');

                    // Re-translate modal content after opening
                    setTimeout(() => {
                        if (typeof updateTranslations === 'function') {
                            updateTranslations();
                        }
                    }, 100);
                }
            } catch (error) {
                console.error('Erreur lors du chargement des dtails:', error);
                showNotification('Impossible de charger les dtails du rapport: ' + error.message, 'error');
            }
        }

        // Accuser rception d'un rapport
        function resolveDirectorId() {
            try {
                const storedUser = JSON.parse(localStorage.getItem('user') || 'null');
                const candidates = [
                    currentUser?.user_id,
                    currentUser?.employee_id,
                    currentUser?.id,
                    storedUser?.id,
                    storedUser?.user_id,
                    storedUser?.employee_id
                ].filter(Boolean);
                return candidates.find(id => UUID_REGEX.test(id)) || null;
            } catch (error) {
                console.warn(' Unable to resolve director ID:', error.message);
                return null;
            }
        }

        async function acknowledgeReport(reportId) {
            try {
                const directorId = resolveDirectorId();

                if (!directorId) {
                    console.error(' Director ID missing or invalid for acknowledgement', { currentUser });
                    showNotification('Impossible d\'identifier le directeur (ID manquant ou invalide).', 'error');
                    return;
                }

                const response = await fetch(`${API}/api/rapportemp/director/${reportId}/acknowledge`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({ director_id: directorId })
                });

                if (!response.ok) {
                    throw new Error('Erreur lors de l\'accus de rception');
                }

                const result = await response.json();
                if (result.success) {
                    // Mettre  jour le rapport dans la liste locale
                    const reportIndex = reports.findIndex(r => r.id === reportId);
                    if (reportIndex !== -1) {
                        reports[reportIndex].status = 'acknowledged';
                    }

                    // Rafrachir l'affichage
                    updateStatistics();
                    displayReports();

                    // Recharger les dtails si le modal est ouvert
                    if (!document.getElementById('reportDetailsModal').classList.contains('hidden')) {
                        await viewReportDetails(reportId);
                    }

                    // Notification de succs
                    showNotification('Accus de rception envoy avec succs', 'success');
                } else {
                    throw new Error(result.error || 'Erreur inconnue');
                }
            } catch (error) {
                console.error('Erreur accus rception:', error);
                showNotification('Erreur lors de l\'accus de rception: ' + error.message, 'error');
            }
        }

        // Accuser rception de tous les rapports en attente
        async function acknowledgeAllPendingReports() {
            const pendingReports = reports.filter(r => r.status === 'pending');

            if (pendingReports.length === 0) {
                showNotification('Aucun rapport en attente', 'info');
                return;
            }

            if (!confirm(`Voulez-vous vraiment accuser rception de tous les ${pendingReports.length} rapports en attente ?`)) {
                return;
            }

            const btn = document.getElementById('acknowledgeAllBtn');
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<div class="loading-spinner"></div> Traitement...';
            btn.disabled = true;

            try {
                let successCount = 0;
                let errorCount = 0;

                for (const report of pendingReports) {
                    try {
                        await acknowledgeReport(report.id);
                        successCount++;
                    } catch (error) {
                        errorCount++;
                        console.error(`Erreur pour rapport ${report.id}:`, error);
                    }
                }

                if (successCount > 0) {
                    showNotification(`${successCount} rapports accuss avec succs${errorCount > 0 ? `, ${errorCount} erreurs` : ''}`,
                        successCount > errorCount ? 'success' : 'warning');
                } else {
                    showNotification('Aucun rapport n\'a pu tre accus', 'error');
                }
            } catch (error) {
                console.error('Erreur accus global:', error);
                showNotification('Erreur lors du traitement global', 'error');
            } finally {
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }
        }

        // Fermer le modal des dtails
        function closeReportDetails() {
            const modal = document.getElementById('reportDetailsModal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }
        }

        // Obtenir les rapports filtrs
        function getFilteredReports() {
            let filtered = [...reports];

            const statusFilter = document.querySelector('.filter-button[data-status].active')?.dataset.status;
            if (statusFilter && statusFilter !== 'all') {
                filtered = filtered.filter(r => r.status === statusFilter);
            }

            const periodFilter = document.querySelector('.filter-button[data-period].active')?.dataset.period;
            if (periodFilter && periodFilter !== 'all') {
                const now = new Date();
                filtered = filtered.filter(r => {
                    const reportDate = new Date(r.created_at);
                    switch (periodFilter) {
                        case 'today':
                            return reportDate.toDateString() === now.toDateString();
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return reportDate >= weekAgo;
                        case 'month':
                            return reportDate.getMonth() === now.getMonth() && reportDate.getFullYear() === now.getFullYear();
                        default:
                            return true;
                    }
                });
            }
            // Priode personnalise (client-side)
            const startEl = document.getElementById('customStart');
            const endEl = document.getElementById('customEnd');
            const startVal = startEl ? startEl.value : null;
            const endVal = endEl ? endEl.value : null;
            if (startVal || endVal) {
                const start = startVal ? new Date(startVal) : null;
                const end = endVal ? new Date(endVal) : null;
                if (end) end.setHours(23, 59, 59, 999);
                filtered = filtered.filter(r => {
                    const d = new Date(r.created_at);
                    if (start && d < start) return false;
                    if (end && d > end) return false;
                    return true;
                });
            }
            // Recherche texte (client-side)
            const term = document.getElementById('textSearch')?.value?.trim().toLowerCase();
            if (term) {
                filtered = filtered.filter(r => {
                    const recipientDisplay = r.remarks ? r.remarks.split('|')[0].trim() : '';
                    const haystack = [
                        r.title,
                        r.subject,
                        recipientDisplay,
                        r.remarks,
                        r.content,
                        r.employee_name,
                        r.department_name
                    ]
                        .filter(Boolean)
                        .join(' ')
                        .toLowerCase();
                    return haystack.includes(term);
                });
            }

            return filtered;
        }

        // Appliquer les filtres
        function applyFilters() {
            resetPagination();
            // Mettre  jour les filtres selon les slections actuelles
            currentFilters.type = document.querySelector('.report-type-tab.active')?.dataset.type || 'all';
            currentFilters.status = document.querySelector('.filter-button[data-status].active')?.dataset.status || 'all';
            currentFilters.period = document.querySelector('.filter-button[data-period].active')?.dataset.period || 'all';

            // Mettre  jour les filtres selon le type de rapport
            if (currentFilters.type === 'all') {
                // Filtres pour "Tous les rapports"
                currentFilters.department_id = document.getElementById('departmentFilter').value;
                currentFilters.employee_id = document.getElementById('employeeFilter').value;
                currentFilters.responsible_id = document.getElementById('responsibleFilter').value;
            } else if (currentFilters.type === 'employee') {
                // Filtres pour "Rapports Employs"
                currentFilters.department_id = document.getElementById('employeeDeptFilter').value;
                currentFilters.employee_id = document.getElementById('employeeOnlyFilter').value;
                currentFilters.responsible_id = 'all'; // Pas de filtre responsable pour les rapports employs
            } else if (currentFilters.type === 'responsible') {
                // Filtres pour "Rapports Responsables"
                currentFilters.department_id = document.getElementById('responsibleDeptFilter').value;
                currentFilters.employee_id = 'all'; // Pas de filtre employ pour les rapports responsables
                currentFilters.responsible_id = document.getElementById('responsibleOnlyFilter').value;
            }

            console.log('Filtres appliqus:', currentFilters);

            // Recharger les rapports avec les nouveaux filtres
            loadReports();
        }

        // Obtenir la classe CSS du statut
        function getStatusClass(status) {
            const classes = {
                'acknowledged': 'bg-green-100 text-green-800',
                'pending': 'bg-yellow-100 text-yellow-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }

        // Obtenir le texte du statut
        function getStatusText(status) {
            if (typeof translate === 'function') {
                const translationKeys = {
                    'acknowledged': 'report.acknowledged',
                    'pending': 'report.pending'
                };
                return translate(translationKeys[status]) || translate('common.unknown');
            }
            const texts = {
                'acknowledged': typeof translate === 'function' ? translate('report.acknowledged') : 'Accus de rception',
                'pending': typeof translate === 'function' ? translate('report.pending') : 'En attente'
            };
            return texts[status] || 'Inconnu';
        }

        // Formater la date
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('fr-FR');
        }

        // Formater la date et l'heure
        function formatDateTime(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Afficher le loading
        function showLoading(show) {
            const reportsList = document.getElementById('reportsList');
            if (show) {
                reportsList.innerHTML = `
                    <div class="flex justify-center items-center py-12">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
                        <span class="ml-3 text-gray-600">Chargement des rapports...</span>
                    </div>
                `;
            }
        }

        // Afficher le message "aucun rapport"
        function showNoReports() {
            const reportsList = document.getElementById('reportsList');
            reportsList.innerHTML = `
                <div class="text-center py-12 text-gray-500">
                    <i class="fas fa-inbox text-4xl mb-4"></i>
                    <p>Aucun rapport trouv</p>
                </div>
            `;
            document.getElementById('reportsCount').textContent = '0';
        }

        // Afficher une notification
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };

            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-full`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);

            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 4000);
        }

        // Appliquer la priode personnalise
        function applyCustomDateRange() {
            const startEl = document.getElementById('customStart');
            const endEl = document.getElementById('customEnd');
            const startVal = startEl ? startEl.value : null;
            const endVal = endEl ? endEl.value : null;

            if (!startVal || !endVal) {
                showNotification('Veuillez slectionner une date de dbut et une date de fin.', 'warning');
                return;
            }

            const start = new Date(startVal);
            const end = new Date(endVal);
            if (end) end.setHours(23, 59, 59, 999); // Fin de la journe pour la date de fin

            currentFilters.period = 'custom';
            currentFilters.start_date = start.toISOString();
            currentFilters.end_date = end.toISOString();

            console.log('Filtres appliqus (priode personnalise):', currentFilters);
            loadReports();
        }


        // Fonctions globales
        window.viewReportDetails = viewReportDetails;
        window.closeReportDetails = closeReportDetails;
        window.acknowledgeReport = acknowledgeReport;
        window.previousPage = previousPage;
        window.nextPage = nextPage;
        window.downloadReportPDF = downloadReportPDF;
        window.selectReportType = selectReportType;
        window.selectFilter = selectFilter;
        window.applyFilters = applyFilters;
        window.clearAllFilters = clearAllFilters;
        window.loadDepartmentData = loadDepartmentData;
        window.loadEmployeeDepartmentData = loadEmployeeDepartmentData;
        window.loadResponsibleDepartmentData = loadResponsibleDepartmentData;
        window.applyCustomDateRange = applyCustomDateRange;

        // Tab switching functionality
        const TABS = ['rapport', 'priority', 'statistics'];

        // Function to auto-resize iframes
        function resizeIframe(iframe) {
            try {
                if (iframe && iframe.contentWindow && iframe.contentWindow.document.body) {
                    const height = iframe.contentWindow.document.body.scrollHeight;
                    iframe.style.height = height + 'px';
                }
            } catch (e) {
                // Cross-origin restrictions may prevent access
                console.log('Cannot resize iframe due to cross-origin restrictions');
            }
        }

        function bindTabs() {
            const buttons = document.querySelectorAll('#reportTabs [data-tab]');
            buttons.forEach(btn => btn.addEventListener('click', (e) => {
                e.preventDefault();
                const tab = btn.getAttribute('data-tab');

                // Update button styles and inline styles
                buttons.forEach(b => {
                    b.classList.remove('active');
                    // Reset to inactive inline styles
                    b.style.background = 'transparent';
                    b.style.color = '#475569';
                    b.style.fontWeight = '500';
                    b.style.boxShadow = 'none';
                    b.style.transform = 'none';
                    // Update icon color
                    const icon = b.querySelector('i');
                    if (icon) {
                        icon.style.color = '#64748b';
                    }
                });

                // Apply active styles to clicked button
                btn.classList.add('active');
                btn.style.background = 'linear-gradient(135deg, #3b82f6 0%, #6366f1 100%)';
                btn.style.color = 'white';
                btn.style.fontWeight = '600';
                btn.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.25)';
                btn.style.transform = 'translateY(-1px)';
                // Update icon color for active tab
                const activeIcon = btn.querySelector('i');
                if (activeIcon) {
                    activeIcon.style.color = 'rgba(255, 255, 255, 0.9)';
                }

                // Show/hide panels with animation
                TABS.forEach(t => {
                    const panel = document.getElementById(`panel-${t}`);
                    if (panel) {
                        if (t === tab) {
                            panel.classList.remove('hidden');
                            panel.classList.add('animate-fadeIn');
                            // Remove animation class after animation completes
                            setTimeout(() => panel.classList.remove('animate-fadeIn'), 400);

                            // Auto-resize iframe if present
                            const iframe = panel.querySelector('iframe');
                            if (iframe) {
                                iframe.onload = function () {
                                    resizeIframe(iframe);
                                    // Re-check size periodically for dynamic content
                                    setInterval(() => resizeIframe(iframe), 500);
                                };
                                // Trigger resize if already loaded
                                if (iframe.contentWindow) {
                                    resizeIframe(iframe);
                                }
                            }
                        } else {
                            panel.classList.add('hidden');
                        }
                    }
                });
            }));
        }

        // Initialize tabs on page load
        document.addEventListener('DOMContentLoaded', () => {
            bindTabs();
        });

        // =====================
        // User Data & Date Display
        // =====================

        // Load user data from AuthManager
        function loadUserData() {
            try {
                let user = null;

                // Try to get user from parent window's authManager
                try {
                    if (window.parent && window.parent !== window && window.parent.authManager) {
                        user = window.parent.authManager.getUser();
                    }
                } catch (e) {
                    console.warn('Could not access parent authManager:', e);
                }

                // Try local authManager
                if (!user && typeof authManager !== 'undefined' && authManager && authManager.getUser) {
                    try {
                        user = authManager.getUser();
                    } catch (e) {
                        console.warn('Could not access local authManager:', e);
                    }
                }

                // Fallback to currentUser if available
                if (!user && typeof currentUser !== 'undefined' && currentUser) {
                    user = currentUser;
                }

                if (user) {
                    // Set user name
                    const fullName = `${user.first_name || ''} ${user.last_name || ''}`.trim() || user.username || 'Director';
                    const userNameElement = document.getElementById('userName');
                    if (userNameElement) {
                        userNameElement.textContent = fullName;
                    }

                    // Set user role
                    const roleMap = {
                        'Director': 'Director',
                        'HR_Manager': 'HR Manager',
                        'Department_Responsible': 'Department Head',
                        'Employee': 'Employee'
                    };
                    const displayRole = roleMap[user.role] || user.role || 'Director';
                    const userRoleElement = document.getElementById('userRole');
                    if (userRoleElement) {
                        userRoleElement.textContent = displayRole;
                    }

                    // Set user initials
                    const initials = getInitials(fullName);
                    const userInitialsElement = document.getElementById('userInitials');
                    if (userInitialsElement) {
                        userInitialsElement.textContent = initials;
                    }

                    // If user has profile image, set it
                    if (user.profile_image) {
                        const avatarElement = document.getElementById('userAvatar');
                        if (avatarElement) {
                            avatarElement.innerHTML = `<img src="${user.profile_image}" alt="${fullName}">`;
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Get initials from full name
        function getInitials(name) {
            if (!name) return 'D';

            const parts = name.trim().split(' ').filter(p => p.length > 0);
            if (parts.length === 0) return 'D';
            if (parts.length === 1) return parts[0].charAt(0).toUpperCase();

            // Get first letter of first name and last name
            return (parts[0].charAt(0) + parts[parts.length - 1].charAt(0)).toUpperCase();
        }

        // Update date display with Western numerals
        function updateDateDisplay() {
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                const today = new Date();
                const lang = localStorage.getItem('preferredLanguage') || 'en';
                const options = {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    numberingSystem: 'latn' // Force Western numerals (0-9) for all languages
                };

                let locale = 'en-US';
                if (lang === 'ar') {
                    locale = 'ar-SA';
                } else if (lang === 'fr') {
                    locale = 'fr-FR';
                }

                dateElement.textContent = today.toLocaleDateString(locale, options);
            }
        }

        // =====================
        // Notification System
        // =====================
        let allNotifications = [];
        let notificationRefreshInterval = null;

        // Toggle notification dropdown
        function toggleNotificationDropdown() {
            const dropdown = document.getElementById('notificationDropdown');
            const isHidden = dropdown.classList.contains('hidden');

            if (isHidden) {
                dropdown.classList.remove('hidden');
                loadNotifications();
            } else {
                dropdown.classList.add('hidden');
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function (event) {
            const dropdown = document.getElementById('notificationDropdown');
            const bell = document.getElementById('notificationBell');

            if (dropdown && bell && !dropdown.contains(event.target) && !bell.contains(event.target)) {
                dropdown.classList.add('hidden');
            }
        });


        // Notification bell click handler
        document.getElementById('notificationBell')?.addEventListener('click', function (e) {
            e.stopPropagation();
            toggleNotificationDropdown();
        });

        // Mark all as read
        document.getElementById('markAllReadBtn')?.addEventListener('click', function (e) {
            e.stopPropagation();
            markAllAsRead();
        });

        // Load all notifications
        async function loadNotifications() {
            showNotificationLoading();

            try {
                const [tasks, reports, complaints, signals] = await Promise.all([
                    loadTaskNotifications(),
                    loadReportNotifications(),
                    loadComplaintNotifications(),
                    loadSignalNotifications()
                ]);

                // Combine all notifications
                allNotifications = [...tasks, ...reports, ...complaints, ...signals];

                // Sort by timestamp (newest first)
                allNotifications.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                // Update badge
                const unreadCount = allNotifications.filter(n => !n.isRead).length;
                updateNotificationBadge(unreadCount);

                // Render notifications
                renderNotifications(allNotifications);

            } catch (error) {
                console.error('Error loading notifications:', error);
                showNotificationEmpty();
            }
        }

        // Load task notifications
        async function loadTaskNotifications() {
            try {
                const response = await fetch(`${API}/tasks`, {
                    headers: getAuthHeaders()
                });

                if (!response.ok) return [];

                const tasks = await response.json();
                const notifications = [];

                // Get current user
                let user = null;
                try {
                    if (window.parent && window.parent !== window && window.parent.authManager) {
                        user = window.parent.authManager.getUser();
                    } else if (typeof authManager !== 'undefined' && authManager && authManager.getUser) {
                        user = authManager.getUser();
                    }
                } catch (e) { }

                if (!user) return [];

                // Filter tasks assigned to director or overdue
                const now = new Date();
                tasks.forEach(task => {
                    const dueDate = task.due_date ? new Date(task.due_date) : null;
                    const isOverdue = dueDate && dueDate < now && task.status !== 'Completed';
                    const isPending = task.status === 'Pending' || task.status === 'In Progress';

                    if (isOverdue) {
                        notifications.push({
                            id: `task-${task.id}`,
                            type: 'task',
                            title: task.title || 'Task',
                            message: `Overdue task - Due ${formatNotificationDate(dueDate)}`,
                            link: `director.html?task=${task.id}`,
                            icon: 'fa-tasks',
                            color: '#ef4444',
                            timestamp: task.created_at,
                            isRead: false
                        });
                    } else if (isPending && task.priority === 'high') {
                        notifications.push({
                            id: `task-${task.id}`,
                            type: 'task',
                            title: task.title || 'Task',
                            message: 'High priority task pending',
                            link: `director.html?task=${task.id}`,
                            icon: 'fa-tasks',
                            color: '#3b82f6',
                            timestamp: task.created_at,
                            isRead: false
                        });
                    }
                });

                return notifications.slice(0, 10); // Limit to 10 most recent
            } catch (error) {
                console.error('Error loading task notifications:', error);
                return [];
            }
        }

        // Load report notifications
        async function loadReportNotifications() {
            try {
                const response = await fetch(`${API}/api/rapportemp/director/all-reports`, {
                    headers: getAuthHeaders()
                });

                if (!response.ok) return [];

                const data = await response.json();
                const reports = data.reports || [];
                const notifications = [];

                reports.forEach(report => {
                    let analysis = report.analysis;
                    if (typeof analysis === 'string') {
                        try {
                            analysis = JSON.parse(analysis);
                        } catch (e) {
                            analysis = null;
                        }
                    }

                    const urgencyScore = analysis?.urgency?.score || 0;

                    // Only show urgent reports (score >= 8) or pending reports
                    if (report.status === 'pending' && urgencyScore >= 8) {
                        notifications.push({
                            id: `report-${report.id}`,
                            type: 'report',
                            title: report.title || 'Report',
                            message: `Urgent report - Priority score: ${urgencyScore}/10`,
                            link: `priorities.html?report=${report.id}`,
                            icon: 'fa-file-alt',
                            color: '#f59e0b',
                            timestamp: report.created_at,
                            isRead: false
                        });
                    }
                });

                return notifications.slice(0, 10);
            } catch (error) {
                console.error('Error loading report notifications:', error);
                return [];
            }
        }

        // Load complaint notifications
        async function loadComplaintNotifications() {
            try {
                const response = await fetch(`${API}/api/director/complaints-statistics`, {
                    headers: getAuthHeaders()
                });

                if (!response.ok) return [];

                const data = await response.json();
                const overview = data.overview || {};
                const notifications = [];

                // Show notification for pending complaints
                if (overview.pending > 0) {
                    notifications.push({
                        id: 'complaints-pending',
                        type: 'complaint',
                        title: 'Pending Complaints',
                        message: `${overview.pending} complaint${overview.pending > 1 ? 's' : ''} awaiting review`,
                        link: 'complaints_director.html',
                        icon: 'fa-comment',
                        color: '#ef4444',
                        timestamp: new Date().toISOString(),
                        isRead: false
                    });
                }

                // Show notification for overdue complaints
                if (overview.overdue > 0) {
                    notifications.push({
                        id: 'complaints-overdue',
                        type: 'complaint',
                        title: 'Overdue Complaints',
                        message: `${overview.overdue} complaint${overview.overdue > 1 ? 's' : ''} past due date`,
                        link: 'complaints_director.html',
                        icon: 'fa-comment',
                        color: '#dc2626',
                        timestamp: new Date().toISOString(),
                        isRead: false
                    });
                }

                return notifications;
            } catch (error) {
                console.error('Error loading complaint notifications:', error);
                return [];
            }
        }

        // Load signal notifications
        async function loadSignalNotifications() {
            try {
                const response = await fetch(`${API}/api/director/signals-stats`, {
                    headers: getAuthHeaders()
                });

                if (!response.ok) return [];

                const data = await response.json();
                const overview = data.overview || {};
                const notifications = [];

                // Show notification for pending signals
                if (overview.pending > 0) {
                    notifications.push({
                        id: 'signals-pending',
                        type: 'signal',
                        title: 'Pending Signals',
                        message: `${overview.pending} signal${overview.pending > 1 ? 's' : ''} awaiting treatment`,
                        link: 'signals_responsible.html',
                        icon: 'fa-exclamation-triangle',
                        color: '#10b981',
                        timestamp: new Date().toISOString(),
                        isRead: false
                    });
                }

                // Show notification for high priority signals
                if (overview.high_priority > 0) {
                    notifications.push({
                        id: 'signals-high-priority',
                        type: 'signal',
                        title: 'High Priority Signals',
                        message: `${overview.high_priority} high priority signal${overview.high_priority > 1 ? 's' : ''}`,
                        link: 'signals_responsible.html',
                        icon: 'fa-exclamation-triangle',
                        color: '#059669',
                        timestamp: new Date().toISOString(),
                        isRead: false
                    });
                }

                return notifications;
            } catch (error) {
                console.error('Error loading signal notifications:', error);
                return [];
            }
        }

        // Update notification badge
        function updateNotificationBadge(count) {
            const badge = document.getElementById('notificationCount');
            if (badge) {
                badge.textContent = count;
                if (count > 0) {
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        // Render notifications
        function renderNotifications(notifications) {
            const listContainer = document.getElementById('notificationList');
            const loading = document.getElementById('notificationLoading');
            const empty = document.getElementById('notificationEmpty');

            // Hide loading
            if (loading) loading.style.display = 'none';

            // Remove existing notification items
            const existingItems = listContainer.querySelectorAll('.notification-item');
            existingItems.forEach(item => item.remove());

            if (notifications.length === 0) {
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');

            // Render each notification
            notifications.forEach(notification => {
                const item = createNotificationItem(notification);
                listContainer.appendChild(item);
            });
        }

        // Create notification item HTML
        function createNotificationItem(notification) {
            const div = document.createElement('div');
            div.className = `notification-item ${notification.isRead ? '' : 'unread'}`;
            div.style.position = 'relative';

            div.innerHTML = `
                <div class="notification-icon ${notification.type}">
                    <i class="fas ${notification.icon}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${notification.title}</div>
                    <div class="notification-message">${notification.message}</div>
                    <div class="notification-time">
                        <i class="fas fa-clock"></i>
                        ${formatRelativeTime(notification.timestamp)}
                    </div>
                </div>
            `;

            div.addEventListener('click', () => {
                window.location.href = notification.link;
            });

            return div;
        }

        // Format relative time
        function formatRelativeTime(timestamp) {
            const now = new Date();
            const date = new Date(timestamp);
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;

            return formatNotificationDate(date);
        }

        // Format date for notifications
        function formatNotificationDate(date) {
            if (!date) return '';
            const d = new Date(date);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // Show loading state
        function showNotificationLoading() {
            const loading = document.getElementById('notificationLoading');
            const empty = document.getElementById('notificationEmpty');

            if (loading) loading.style.display = 'flex';
            if (empty) empty.classList.add('hidden');
        }

        // Show empty state
        function showNotificationEmpty() {
            const loading = document.getElementById('notificationLoading');
            const empty = document.getElementById('notificationEmpty');

            if (loading) loading.style.display = 'none';
            if (empty) empty.classList.remove('hidden');
        }

        // Mark all as read
        function markAllAsRead() {
            allNotifications.forEach(n => n.isRead = true);
            updateNotificationBadge(0);
            renderNotifications(allNotifications);
        }

        // Auto-refresh notifications every 30 seconds
        function startNotificationRefresh() {
            // Clear existing interval
            if (notificationRefreshInterval) {
                clearInterval(notificationRefreshInterval);
            }

            // Refresh every 30 seconds
            notificationRefreshInterval = setInterval(() => {
                loadNotifications();
            }, 30000);
        }

        // Export reports function
        function exportReports() {
            showNotification('Export feature coming soon!', 'info');
        }

        // Handle language switching and RTL direction
        function handleLanguageDirection() {
            const languageSelector = document.getElementById('languageSelector');
            const body = document.body;
            const quickActionsContainer = document.getElementById('quickActionsContainer');

            if (languageSelector && quickActionsContainer) {
                const updateDirection = () => {
                    const selectedLang = languageSelector.value;

                    if (selectedLang === 'ar') {
                        body.setAttribute('dir', 'rtl');
                        quickActionsContainer.style.justifyContent = 'flex-start';
                    } else {
                        body.removeAttribute('dir');
                        quickActionsContainer.style.justifyContent = 'flex-end';
                    }

                    // Improve filter layout after direction change
                    setTimeout(improveFilterLayoutForArabic, 100);
                };

                // Initial setup
                updateDirection();

                // Update on language change
                languageSelector.addEventListener('change', updateDirection);
            }
        }

        // Add missing translations
        function addMissingTranslations() {
            // Wait for translations to be loaded
            if (typeof translations === 'undefined') {
                setTimeout(addMissingTranslations, 100);
                return;
            }

            // Ensure report object exists
            if (!translations.en.report) translations.en.report = {};
            if (!translations.fr.report) translations.fr.report = {};
            if (!translations.ar.report) translations.ar.report = {};

            // English
            translations.en.report.view_priorities = 'View Priorities';
            translations.en.report.export_reports = 'Export Reports';
            translations.en.report.specific_filters = 'Specific Filters';
            translations.en.report.search = 'Search';

            // French  
            translations.fr.report.view_priorities = 'Voir les priorits';
            translations.fr.report.export_reports = 'Exporter les rapports';
            translations.fr.report.specific_filters = 'Filtres spcifiques';
            translations.fr.report.search = 'Recherche';

            // Arabic
            translations.ar.report.view_priorities = ' ';
            translations.ar.report.export_reports = ' ';
            translations.ar.report.specific_filters = ' ';
            translations.ar.report.search = '';

            // Force update the page with new translations
            if (typeof updateTranslations === 'function') {
                updateTranslations();
            }

            // Manual update for specific elements that might not update
            setTimeout(() => {
                const specificFiltersElement = document.querySelector('[data-translate="report.specific_filters"]');
                const searchElement = document.querySelector('[data-translate="report.search"]');

                if (specificFiltersElement && translations.ar.report.specific_filters) {
                    const currentLang = document.getElementById('languageSelector')?.value;
                    if (currentLang === 'ar') {
                        specificFiltersElement.textContent = translations.ar.report.specific_filters;
                    }
                }

                if (searchElement && translations.ar.report.search) {
                    const currentLang = document.getElementById('languageSelector')?.value;
                    if (currentLang === 'ar') {
                        searchElement.textContent = translations.ar.report.search;
                    }
                }
            }, 200);
        }

        // Improve filter layout for Arabic
        function improveFilterLayoutForArabic() {
            const body = document.body;
            const isRTL = body.getAttribute('dir') === 'rtl';

            if (isRTL) {
                console.log('Applying RTL improvements for filters');

                // Fix main filter panel layout
                const filterPanel = document.querySelector('.director-panel');
                if (filterPanel) {
                    filterPanel.style.direction = 'rtl';
                }

                // Fix main flex container
                const mainFlex = filterPanel?.querySelector('.flex');
                if (mainFlex) {
                    mainFlex.style.flexDirection = 'row-reverse';
                }

                // Fix search icon positioning in RTL
                const searchContainers = document.querySelectorAll('.relative');
                searchContainers.forEach(container => {
                    const icon = container.querySelector('.absolute');
                    const input = container.querySelector('input[type="text"]');
                    if (icon && input) {
                        icon.style.left = 'auto';
                        icon.style.right = '0.75rem';
                        input.style.paddingLeft = '0.75rem';
                        input.style.paddingRight = '2.25rem';
                        input.style.textAlign = 'right';
                        input.style.direction = 'rtl';
                    }
                });

                // Fix filter field groups
                const filterGroups = document.querySelectorAll('.filter-field-group');
                filterGroups.forEach(group => {
                    group.style.textAlign = 'right';
                    group.style.direction = 'rtl';
                    const label = group.querySelector('label');
                    if (label) {
                        label.style.textAlign = 'right';
                        label.style.display = 'block';
                        label.style.direction = 'rtl';
                    }
                    const select = group.querySelector('select');
                    if (select) {
                        select.style.direction = 'rtl';
                        select.style.textAlign = 'right';
                    }
                });

                // Fix all select dropdowns
                const selects = document.querySelectorAll('select');
                selects.forEach(select => {
                    select.style.direction = 'rtl';
                    select.style.textAlign = 'right';
                });

                // Fix button groups
                const buttonGroups = document.querySelectorAll('.flex-wrap');
                buttonGroups.forEach(group => {
                    group.style.flexDirection = 'row-reverse';
                });

                // Fix all buttons
                const buttons = document.querySelectorAll('.filter-button, .report-type-tab');
                buttons.forEach(button => {
                    button.style.direction = 'rtl';
                    button.style.textAlign = 'right';
                });

                // Fix date inputs
                const dateInputs = document.querySelectorAll('input[type="date"]');
                dateInputs.forEach(input => {
                    input.style.direction = 'rtl';
                    input.style.textAlign = 'right';
                });

                // Fix grid layouts
                const grids = document.querySelectorAll('.grid');
                grids.forEach(grid => {
                    grid.style.direction = 'rtl';
                });

                // Fix text elements
                const textElements = document.querySelectorAll('.text-gray-500, label, span');
                textElements.forEach(element => {
                    if (!element.classList.contains('fa')) {
                        element.style.direction = 'rtl';
                        element.style.textAlign = 'right';
                    }
                });
            }
        }

        // Reports List State and Functions
        let reportsViewMode = 'cards'; // 'cards' or 'list'
        let reportsSortOrder = 'asc'; // 'asc' or 'desc'
        let reportsCurrentPage = 1
        let reportsPerPage = 9;
        let allReports = [];

        // Initialize reports functionality
        function initializeReportsList() {
            wireReportsViewModeButtons();
            wireReportsSortButton();
            wireReportsPagination();
            updateReportsData();
        }

        // Wire view mode buttons
        function wireReportsViewModeButtons() {
            const btnCards = document.getElementById('reportsViewModeCards');
            const btnList = document.getElementById('reportsViewModeList');

            if (btnCards && btnList) {
                const updateViewMode = (mode) => {
                    reportsViewMode = mode;

                    // Update button styles
                    if (mode === 'cards') {
                        btnCards.classList.add('bg-gray-100', 'text-gray-600');
                        btnCards.classList.remove('bg-white', 'text-gray-400');
                        btnList.classList.add('bg-white', 'text-gray-400');
                        btnList.classList.remove('bg-gray-100', 'text-gray-600');
                    } else {
                        btnList.classList.add('bg-gray-100', 'text-gray-600');
                        btnList.classList.remove('bg-white', 'text-gray-400');
                        btnCards.classList.add('bg-white', 'text-gray-400');
                        btnCards.classList.remove('bg-gray-100', 'text-gray-600');
                    }

                    renderReportsList();
                };

                btnCards.addEventListener('click', () => updateViewMode('cards'));
                btnList.addEventListener('click', () => updateViewMode('list'));

                // Set initial state
                updateViewMode(reportsViewMode);
            }
        }

        // Wire sort button
        function wireReportsSortButton() {
            const sortBtn = document.getElementById('reportsSortToggle');

            if (sortBtn) {
                sortBtn.addEventListener('click', () => {
                    // Toggle sort direction
                    reportsSortOrder = reportsSortOrder === 'asc' ? 'desc' : 'asc';

                    // Update sort icon
                    const icon = document.getElementById('reportsSortIcon');
                    if (icon) {
                        if (reportsSortOrder === 'asc') {
                            icon.className = 'fas fa-sort-alpha-down';
                        } else {
                            icon.className = 'fas fa-sort-alpha-up';
                        }
                    }

                    // Re-render with sorted data
                    renderReportsList();
                });
            }
        }

        // Wire pagination
        function wireReportsPagination() {
            const prevBtn = document.getElementById('reportsPrevBtn');
            const nextBtn = document.getElementById('reportsNextBtn');

            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    if (reportsCurrentPage > 1) {
                        reportsCurrentPage--;
                        renderReportsList();
                        updateReportsPagination();
                    }
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    const totalPages = Math.ceil(allReports.length / reportsPerPage);
                    if (reportsCurrentPage < totalPages) {
                        reportsCurrentPage++;
                        renderReportsList();
                        updateReportsPagination();
                    }
                });
            }
        }

        // Sort reports by language
        function sortReportsByLanguage(items) {
            const currentLang = document.getElementById('languageSelector')?.value || 'en';

            return [...items].sort((a, b) => {
                const textA = a.title || '';
                const textB = b.title || '';

                let comparison = 0;

                // Arabic sorting
                if (currentLang === 'ar') {
                    comparison = textA.localeCompare(textB, 'ar', { sensitivity: 'base' });
                }
                // French sorting
                else if (currentLang === 'fr') {
                    comparison = textA.localeCompare(textB, 'fr', { sensitivity: 'base', ignorePunctuation: true });
                }
                // English sorting (default)
                else {
                    comparison = textA.localeCompare(textB, 'en', { sensitivity: 'base' });
                }

                return reportsSortOrder === 'asc' ? comparison : -comparison;
            });
        }

        // Get paginated reports
        function getPaginatedReports(reports) {
            const startIndex = (reportsCurrentPage - 1) * reportsPerPage;
            const endIndex = startIndex + reportsPerPage;
            return reports.slice(startIndex, endIndex);
        }

        // Update pagination controls
        function updateReportsPagination() {
            const totalPages = Math.ceil(allReports.length / reportsPerPage);

            // Update page info
            const currentPageEl = document.getElementById('reportsCurrentPage');
            const totalPagesEl = document.getElementById('reportsTotalPages');
            if (currentPageEl) currentPageEl.textContent = reportsCurrentPage;
            if (totalPagesEl) totalPagesEl.textContent = totalPages || 1;

            // Update button states
            const prevBtn = document.getElementById('reportsPrevBtn');
            const nextBtn = document.getElementById('reportsNextBtn');

            if (prevBtn) {
                prevBtn.disabled = reportsCurrentPage === 1;
            }
            if (nextBtn) {
                nextBtn.disabled = reportsCurrentPage >= totalPages;
            }
        }

        // Render reports list
        function renderReportsList() {
            const listEl = document.getElementById('reportsList');
            if (!listEl) return;

            if (!allReports.length) {
                listEl.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p data-translate="report.no_reports">Aucun rapport trouv</p>
                    </div>
                `;
                return;
            }

            // Sort and paginate
            const sortedReports = sortReportsByLanguage(allReports);
            const paginatedReports = getPaginatedReports(sortedReports);

            if (reportsViewMode === 'list') {
                renderReportsListView(paginatedReports, listEl);
            } else {
                renderReportsCardsView(paginatedReports, listEl);
            }

            updateReportsPagination();
        }

        // Render reports as cards
        function renderReportsCardsView(reports, container) {
            // Get translations
            const employeeLabel = typeof translate === 'function' ? translate('report.employee') : 'Employ';
            const departmentLabel = typeof translate === 'function' ? translate('report.department_label') : 'Dpartement';
            const dateLabel = typeof translate === 'function' ? translate('report.created') : 'Date';
            const pdfLabel = typeof translate === 'function' ? translate('report.pdf_document') : 'PDF';
            const availableText = typeof translate === 'function' ? translate('report.available') : 'Disponible';
            const downloadText = typeof translate === 'function' ? translate('report.download') : 'Tlcharger';
            const viewText = typeof translate === 'function' ? translate('report.view') : 'Voir';
            const acknowledgedText = typeof translate === 'function' ? translate('report.acknowledged') : 'Accus';

            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${reports.map(report => {
                const isAcknowledged = report.status === 'acknowledged';
                const formattedDateTime = new Date(report.created_at).toLocaleString('fr-FR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                        <div class="report-card">
                            <div class="report-card-header">
                                <div style="flex: 1; min-width: 0;">
                                    <h4 class="report-card-title">${report.title || 'Rapport'}</h4>
                                    <p class="report-card-description">${report.subject || 'Aucun sujet'}</p>
                                </div>
                                <span style="display: inline-block; padding: 6px 14px; font-size: 0.75rem; font-weight: 600; border-radius: 999px; white-space: nowrap; background: ${getReportStatusColor(report.status)}; color: white;">
                                    ${getStatusText(report.status)}
                                </span>
                            </div>
                            
                            <div class="report-card-meta">
                                <div class="report-meta-item">
                                    <div class="report-meta-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="report-meta-content">
                                        <p class="report-meta-label">${employeeLabel}</p>
                                        <p class="report-meta-value">${report.first_name} ${report.last_name}</p>
                                    </div>
                                </div>
                                <div class="report-meta-item">
                                    <div class="report-meta-icon">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div class="report-meta-content">
                                        <p class="report-meta-label">${departmentLabel}</p>
                                        <p class="report-meta-value">${report.department_name || 'Non spcifi'}</p>
                                    </div>
                                </div>
                                <div class="report-meta-item">
                                    <div class="report-meta-icon">
                                        <i class="fas fa-calendar"></i>
                                    </div>
                                    <div class="report-meta-content">
                                        <p class="report-meta-label">${dateLabel}</p>
                                        <p class="report-meta-value">${formattedDateTime}</p>
                                    </div>
                                </div>
                                ${report.pdf_path || report.pdf_url ? `
                                <div class="report-meta-item">
                                    <div class="report-meta-icon">
                                        <i class="fas fa-file-pdf"></i>
                                    </div>
                                    <div class="report-meta-content">
                                        <p class="report-meta-label">${pdfLabel}</p>
                                        <p class="report-meta-value">${availableText}</p>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="report-card-actions">
                                ${report.pdf_path || report.pdf_url ? `
                                    <button class="report-action-btn" onclick="downloadReportPDF('${report.id}', '${report.pdf_path || report.pdf_url}')" title="Download PDF">
                                        <i class="fas fa-download"></i>
                                        ${downloadText}
                                    </button>
                                ` : ''}
                                <button class="report-action-btn" onclick="viewReportDetails('${report.id}')" title="View Details">
                                    <i class="fas fa-eye"></i>
                                    ${viewText}
                                </button>
                                ${!isAcknowledged ? `
                                    <button class="report-action-btn primary" onclick="acknowledgeReport('${report.id}')" title="Acknowledge">
                                        <i class="fas fa-check"></i>
                                        ${typeof translate === 'function' ? translate('report.acknowledge') : 'Accuser'}
                                    </button>
                                ` : `
                                    <button class="report-action-btn" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border-color: #059669;" disabled title="Acknowledged">
                                        <i class="fas fa-check-circle"></i>
                                        ${acknowledgedText}
                                    </button>
                                `}
                            </div>
                        </div>
                    `;
            }).join('')}
                </div>
            `;
        }

        // Render reports as table
        function renderReportsListView(reports, container) {
            // Get translations
            const titleLabel = typeof translate === 'function' ? translate('report.title_label_modal') : 'Titre';
            const employeeLabel = typeof translate === 'function' ? translate('report.employee') : 'Employ';
            const departmentLabel = typeof translate === 'function' ? translate('report.department_label') : 'Dpartement';
            const dateLabel = typeof translate === 'function' ? translate('report.created') : 'Date';
            const statusLabel = typeof translate === 'function' ? translate('report.status_label') : 'Statut';
            const actionsLabel = typeof translate === 'function' ? translate('common.actions') : 'Actions';
            const acknowledgedText = typeof translate === 'function' ? translate('report.acknowledged') : 'Accus';

            container.innerHTML = `
                <div class="report-table">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th>${titleLabel}</th>
                                <th>${employeeLabel}</th>
                                <th>${departmentLabel}</th>
                                <th>${dateLabel}</th>
                                <th>${statusLabel}</th>
                                <th class="text-right">${actionsLabel}</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${reports.map(report => {
                const isAcknowledged = report.status === 'acknowledged';
                const formattedDateTime = new Date(report.created_at).toLocaleString('fr-FR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                                <tr class="hover:bg-gray-50">
                                    <td>
                                        <div class="text-sm font-medium text-gray-900">${report.title || 'Rapport'}</div>
                                        <div class="text-sm text-gray-500">${report.subject || 'Aucun sujet'}</div>
                                    </td>
                                    <td class="text-sm text-gray-500">${report.employee_name || 'N/A'}</td>
                                    <td class="text-sm text-gray-500">${report.department_name || 'N/A'}</td>
                                    <td class="text-sm text-gray-500">${formattedDateTime}</td>
                                    <td>
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full" style="background: ${getReportStatusColor(report.status)}; color: white;">
                                            ${getStatusText(report.status)}
                                        </span>
                                    </td>
                                    <td class="text-right text-sm font-medium">
                                        <div class="flex justify-end gap-2">
                                            ${report.pdf_path || report.pdf_url ? `
                                                <button class="report-action-btn" onclick="downloadReportPDF('${report.id}', '${report.pdf_path || report.pdf_url}')" title="Download PDF">
                                                    <i class="fas fa-download"></i>
                                                </button>
                                            ` : ''}
                                            <button class="report-action-btn" onclick="viewReportDetails('${report.id}')" title="View Details">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            ${!isAcknowledged ? `
                                                <button class="report-action-btn primary" onclick="acknowledgeReport('${report.id}')" title="Acknowledge">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                            ` : `
                                                <button class="report-action-btn" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border-color: #059669;" disabled title="Acknowledged">
                                                    <i class="fas fa-check-circle"></i>
                                                    <span>${acknowledgedText}</span>
                                                </button>
                                            `}
                                        </div>
                                    </td>
                                </tr>
                            `;
            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Helper functions - use existing functions from the codebase
        function getReportStatusColor(status) {
            const colors = {
                'pending': 'linear-gradient(135deg, #f59e0b, #d97706)',
                'acknowledged': 'linear-gradient(135deg, #10b981, #059669)',
                'rejected': 'linear-gradient(135deg, #ef4444, #dc2626)'
            };
            return colors[status] || colors['pending'];
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR');
        }

        // Update the global reports variable when data is loaded
        function updateReportsData(newReports) {
            allReports = newReports || [];
            renderReportsList();
        }

        // Action handlers - these will be handled by existing functions in the codebase
        // The onclick handlers in the HTML will call the existing functions

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            addMissingTranslations();
            handleLanguageDirection();
            improveFilterLayoutForArabic();
            initializeReportsList();
        });

    </script>
</body>

</html>